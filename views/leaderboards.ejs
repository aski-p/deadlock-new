<div class="leaderboards-section">
    <div class="leaderboards-container">
        <div class="leaderboards-header">
            <h1 class="page-title">ë¦¬ë”ë³´ë“œ - <%= 
                region === 'europe' ? 'ìœ ëŸ½' : 
                region === 'asia' ? 'ì•„ì‹œì•„' : 
                region === 'north-america' ? 'ë¶ë¯¸' :
                region === 'south-america' ? 'ë‚¨ë¯¸' :
                region === 'oceania' ? 'ì˜¤ì„¸ì•„ë‹ˆì•„' : 'ì§€ì—­'
            %></h1>
            
            <div class="region-selector">
                <a href="/ko/leaderboards/europe" class="region-btn <%= region === 'europe' ? 'active' : '' %>">
                    ìœ ëŸ½
                </a>
                <a href="/ko/leaderboards/asia" class="region-btn <%= region === 'asia' ? 'active' : '' %>">
                    ì•„ì‹œì•„
                </a>
                <a href="/ko/leaderboards/north-america" class="region-btn <%= region === 'north-america' ? 'active' : '' %>">
                    ë¶ë¯¸
                </a>
                <a href="/ko/leaderboards/south-america" class="region-btn <%= region === 'south-america' ? 'active' : '' %>">
                    ë‚¨ë¯¸
                </a>
                <a href="/ko/leaderboards/oceania" class="region-btn <%= region === 'oceania' ? 'active' : '' %>">
                    ì˜¤ì„¸ì•„ë‹ˆì•„
                </a>
            </div>
        </div>

        <div class="filters-section">
            <div class="filter-group">
                <label for="hero-filter">ì˜ì›… í•„í„°:</label>
                <select id="hero-filter" class="filter-select">
                    <option value="all">ëª¨ë“  ì˜ì›…</option>
                    <option value="abrams">Abrams</option>
                    <option value="bebop">Bebop</option>
                    <option value="dynamo">Dynamo</option>
                    <option value="grey-talon">Grey Talon</option>
                    <option value="haze">Haze</option>
                    <option value="infernus">Infernus</option>
                    <option value="ivy">Ivy</option>
                    <option value="kelvin">Kelvin</option>
                    <option value="lady-geist">Lady Geist</option>
                    <option value="lash">Lash</option>
                    <option value="mirage">Mirage</option>
                    <option value="mo-krill">Mo & Krill</option>
                    <option value="paradox">Paradox</option>
                    <option value="pocket">Pocket</option>
                    <option value="seven">Seven</option>
                    <option value="shiv">Shiv</option>
                    <option value="vindicta">Vindicta</option>
                    <option value="viscous">Viscous</option>
                    <option value="warden">Warden</option>
                    <option value="wraith">Wraith</option>
                    <option value="yamato">Yamato</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="medal-filter">ë©”ë‹¬ í•„í„°:</label>
                <select id="medal-filter" class="filter-select">
                    <option value="all">ëª¨ë“  ë©”ë‹¬</option>
                    <option value="eternus">ì´í„°ëˆ„ìŠ¤</option>
                    <option value="phantom">íŒ¬í…€</option>
                    <option value="oracle">ì˜¤ë¼í´</option>
                    <option value="ritualist">ë¦¬ì¸„ì–¼ë¦¬ìŠ¤íŠ¸</option>
                    <option value="alchemist">ì•Œì¼€ë¯¸ìŠ¤íŠ¸</option>
                    <option value="arcanist">ì•„ì¼€ë‹ˆìŠ¤íŠ¸</option>
                    <option value="initiate">íƒí—˜ê°€</option>
                </select>
            </div>
        </div>

        <div class="leaderboard-table-container">
            <div class="table-loading" id="table-loading">
                <div class="loading-spinner"></div>
                <p>ë¦¬ë”ë³´ë“œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            
            <table class="leaderboard-table" id="leaderboard-table" style="display: none;">
                <thead>
                    <tr>
                        <th class="rank-column">ìˆœìœ„</th>
                        <th class="player-column">í”Œë ˆì´ì–´</th>
                        <th class="country-column">êµ­ê°€</th>
                        <th class="heroes-column">ì˜ì›…</th>
                        <th class="medal-column">ë©”ë‹¬</th>
                        <th class="score-column">ì ìˆ˜</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-tbody">
                </tbody>
            </table>
            
            <div class="pagination" id="pagination" style="display: none;">
                <button class="pagination-btn" id="prev-btn" disabled>ì´ì „</button>
                <span class="pagination-info" id="pagination-info">1 / 10</span>
                <button class="pagination-btn" id="next-btn">ë‹¤ìŒ</button>
            </div>
        </div>
    </div>
</div>

<script>
let currentPage = 1;
let totalPages = 20;
let currentFilters = {
    region: '<%= region %>',
    hero: 'all',
    medal: 'all'
};

async function loadLeaderboardData() {
    const loading = document.getElementById('table-loading');
    const table = document.getElementById('leaderboard-table');
    
    loading.style.display = 'flex';
    table.style.display = 'none';
    
    try {
        const params = new URLSearchParams({
            page: currentPage,
            limit: 50,
            hero: currentFilters.hero,
            medal: currentFilters.medal
        });
        
        const response = await fetch(`/api/v1/leaderboards/${currentFilters.region}?${params}`);
        const data = await response.json();
        
        if (data.error) {
            throw new Error(data.error);
        }
        
        updateLeaderboardTable(data.data);
        updatePaginationInfo(data.pagination);
        loading.style.display = 'none';
        table.style.display = 'table';
        
    } catch (error) {
        console.error('Failed to load leaderboard data:', error);
        loading.innerHTML = '<p style="color: #ff6b6b;">ë¦¬ë”ë³´ë“œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
    }
}

// êµ­ê°€ í”Œë˜ê·¸ë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
function getCountryImage(countryFlag) {
    const flagImageMap = {
        'ğŸ‡ºğŸ‡¸': '<img src="https://flagcdn.com/24x18/us.png" alt="ë¯¸êµ­" title="ë¯¸êµ­" class="flag-image">',
        'ğŸ‡¨ğŸ‡¦': '<img src="https://flagcdn.com/24x18/ca.png" alt="ìºë‚˜ë‹¤" title="ìºë‚˜ë‹¤" class="flag-image">',
        'ğŸ‡²ğŸ‡½': '<img src="https://flagcdn.com/24x18/mx.png" alt="ë©•ì‹œì½”" title="ë©•ì‹œì½”" class="flag-image">',
        'ğŸ‡¬ğŸ‡§': '<img src="https://flagcdn.com/24x18/gb.png" alt="ì˜êµ­" title="ì˜êµ­" class="flag-image">',
        'ğŸ‡©ğŸ‡ª': '<img src="https://flagcdn.com/24x18/de.png" alt="ë…ì¼" title="ë…ì¼" class="flag-image">',
        'ğŸ‡«ğŸ‡·': '<img src="https://flagcdn.com/24x18/fr.png" alt="í”„ë‘ìŠ¤" title="í”„ë‘ìŠ¤" class="flag-image">',
        'ğŸ‡ªğŸ‡¸': '<img src="https://flagcdn.com/24x18/es.png" alt="ìŠ¤í˜ì¸" title="ìŠ¤í˜ì¸" class="flag-image">',
        'ğŸ‡®ğŸ‡¹': '<img src="https://flagcdn.com/24x18/it.png" alt="ì´íƒˆë¦¬ì•„" title="ì´íƒˆë¦¬ì•„" class="flag-image">',
        'ğŸ‡¨ğŸ‡³': '<img src="https://flagcdn.com/24x18/cn.png" alt="ì¤‘êµ­" title="ì¤‘êµ­" class="flag-image">',
        'ğŸ‡¯ğŸ‡µ': '<img src="https://flagcdn.com/24x18/jp.png" alt="ì¼ë³¸" title="ì¼ë³¸" class="flag-image">',
        'ğŸ‡°ğŸ‡·': '<img src="https://flagcdn.com/24x18/kr.png" alt="í•œêµ­" title="í•œêµ­" class="flag-image">',
        'ğŸ‡¹ğŸ‡¼': '<img src="https://flagcdn.com/24x18/tw.png" alt="ëŒ€ë§Œ" title="ëŒ€ë§Œ" class="flag-image">',
        'ğŸ‡¸ğŸ‡¬': '<img src="https://flagcdn.com/24x18/sg.png" alt="ì‹±ê°€í¬ë¥´" title="ì‹±ê°€í¬ë¥´" class="flag-image">',
        'ğŸ‡·ğŸ‡º': '<img src="https://flagcdn.com/24x18/ru.png" alt="ëŸ¬ì‹œì•„" title="ëŸ¬ì‹œì•„" class="flag-image">',
        'ğŸ‡µğŸ‡±': '<img src="https://flagcdn.com/24x18/pl.png" alt="í´ë€ë“œ" title="í´ë€ë“œ" class="flag-image">',
        'ğŸ‡¸ğŸ‡ª': '<img src="https://flagcdn.com/24x18/se.png" alt="ìŠ¤ì›¨ë´" title="ìŠ¤ì›¨ë´" class="flag-image">',
        'ğŸ‡³ğŸ‡´': '<img src="https://flagcdn.com/24x18/no.png" alt="ë…¸ë¥´ì›¨ì´" title="ë…¸ë¥´ì›¨ì´" class="flag-image">',
        'ğŸ‡©ğŸ‡°': '<img src="https://flagcdn.com/24x18/dk.png" alt="ë´ë§ˆí¬" title="ë´ë§ˆí¬" class="flag-image">',
        'ğŸ‡¹ğŸ‡­': '<img src="https://flagcdn.com/24x18/th.png" alt="íƒœêµ­" title="íƒœêµ­" class="flag-image">',
        'ğŸ‡»ğŸ‡³': '<img src="https://flagcdn.com/24x18/vn.png" alt="ë² íŠ¸ë‚¨" title="ë² íŠ¸ë‚¨" class="flag-image">',
        'ğŸ‡²ğŸ‡¾': '<img src="https://flagcdn.com/24x18/my.png" alt="ë§ë ˆì´ì‹œì•„" title="ë§ë ˆì´ì‹œì•„" class="flag-image">',
        'ğŸ‡µğŸ‡­': '<img src="https://flagcdn.com/24x18/ph.png" alt="í•„ë¦¬í•€" title="í•„ë¦¬í•€" class="flag-image">',
        'ğŸ‡®ğŸ‡©': '<img src="https://flagcdn.com/24x18/id.png" alt="ì¸ë„ë„¤ì‹œì•„" title="ì¸ë„ë„¤ì‹œì•„" class="flag-image">',
        'ğŸŒ': '<img src="https://flagcdn.com/24x18/un.png" alt="ì•Œ ìˆ˜ ì—†ìŒ" title="ì•Œ ìˆ˜ ì—†ìŒ" class="flag-image">'
    };
    
    return flagImageMap[countryFlag] || '<img src="https://flagcdn.com/24x18/un.png" alt="ì•Œ ìˆ˜ ì—†ìŒ" title="ì•Œ ìˆ˜ ì—†ìŒ" class="flag-image">';
}

function updateLeaderboardTable(data) {
    const tbody = document.getElementById('leaderboard-tbody');
    
    // ë©”ë‹¬ ì´ë¯¸ì§€ ë§¤í•‘ - deadlock.coach CDN ì‚¬ìš©
    const getMedalImage = (medal, subrank) => {
        const medalRankMap = {
            'eternus': 11,
            'phantom': 10,
            'oracle': 9,
            'ritualist': 8,
            'alchemist': 7,
            'arcanist': 6,
            'initiate': 5
        };
        
        const rankNumber = medalRankMap[medal.toLowerCase()] || 5;
        const subrankFormatted = subrank || 1;
        
        return `https://cdn.deadlock.coach/vpk/panorama/images/ranked/badges/rank${rankNumber}/badge_sm_subrank${subrankFormatted}.webp`;
    };

    // ì˜ì–´ ë©”ë‹¬ì„ í•œê¸€ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
    const getKoreanMedal = (englishMedal) => {
        const medalTranslation = {
            'Eternus': 'ì´í„°ëˆ„ìŠ¤',
            'Phantom': 'íŒ¬í…€', 
            'Oracle': 'ì˜¤ë¼í´',
            'Ritualist': 'ë¦¬ì¸„ì–¼ë¦¬ìŠ¤íŠ¸',
            'Alchemist': 'ì•Œì¼€ë¯¸ìŠ¤íŠ¸',
            'Arcanist': 'ì•„ì¼€ë‹ˆìŠ¤íŠ¸',
            'Initiate': 'íƒí—˜ê°€'
        };
        return medalTranslation[englishMedal] || englishMedal;
    };

    // ì˜ì›… ì´ë¯¸ì§€ ë§¤í•‘ - deadlock.coach CDN ì‚¬ìš©
    const getHeroImage = (heroName) => {
        const heroImageMap = {
            'Abrams': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/bull_card.webp',
            'Bebop': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/bebop_card.webp',
            'Dynamo': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/dynamo_card.webp',
            'Grey Talon': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/archer_card.webp',
            'Haze': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/haze_card.webp',
            'Infernus': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/inferno_card.webp',
            'Ivy': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/tengu_card.webp',
            'Kelvin': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/kelvin_card.webp',
            'Lady Geist': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/spectre_card.webp',
            'Lash': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/lash_card.webp',
            'McGinnis': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/engineer_card.webp',
            'Mo & Krill': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/digger_card.webp',
            'Paradox': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/chrono_card.webp',
            'Pocket': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/synth_card.webp',
            'Seven': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/gigawatt_card.webp',
            'Shiv': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/shiv_card.webp',
            'Vindicta': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/hornet_card.webp',
            'Viper': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/kali_card.webp',
            'Viscous': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/viscous_card.webp',
            'Warden': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/warden_card.webp',
            'Wraith': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/wraith_card.webp',
            'Yamato': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/yamato_card.webp',
            'Calico': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/calico_card.webp',
            'Holliday': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/astro_card.webp',
            'Mirage': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/mirage_card.webp',
            'Sinclair': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/magician_card.webp'
        };
        
        return heroImageMap[heroName] || 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/bull_card.webp';
    };
    
    tbody.innerHTML = data.map(player => 
        '<tr class="leaderboard-row">' +
        '<td class="rank-cell">' +
            '<span class="rank-number">' + player.rank + '</span>' +
        '</td>' +
        '<td class="player-cell">' +
            '<div class="player-info">' +
                '<img src="' + player.player.avatar + '" alt="' + player.player.name + '" class="player-avatar" onerror="this.src=\'data:image/svg+xml;charset=utf-8,' + encodeURIComponent('<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"40\" height=\"40\" viewBox=\"0 0 40 40\"><circle cx=\"20\" cy=\"20\" r=\"18\" fill=\"#666\" stroke=\"#fff\" stroke-width=\"2\"/><circle cx=\"20\" cy=\"15\" r=\"5\" fill=\"#fff\"/><path d=\"M10 30 Q20 25 30 30\" stroke=\"#fff\" stroke-width=\"3\" fill=\"none\"/></svg>') + '\'">' +
                '<a href="/ko/players/' + (player.player.accountId || player.player.steamId || player.rank) + '" class="player-name-link">' +
                    '<span class="player-name">' + player.player.name + '</span>' +
                '</a>' +
            '</div>' +
        '</td>' +
        '<td class="country-cell">' +
            '<span class="country-flag">' + getCountryImage(player.player.country) + '</span>' +
        '</td>' +
        '<td class="heroes-cell">' +
            '<div class="heroes-list">' +
                player.heroes.map(hero => 
                    '<div class="hero-item">' +
                        '<a href="/ko/players/' + (player.player.accountId || player.player.steamId || player.rank) + '" class="hero-link">' +
                            '<img src="' + getHeroImage(hero) + '" alt="' + hero + '" class="hero-image" title="' + hero + '">' +
                        '</a>' +
                    '</div>'
                ).join('') +
            '</div>' +
        '</td>' +
        '<td class="medal-cell">' +
            '<div class="medal-badge">' +
                '<img src="' + getMedalImage(player.medal, player.subrank) + '" alt="' + getKoreanMedal(player.medal) + ' ' + player.subrank + '" class="medal-image" title="' + getKoreanMedal(player.medal) + ' ' + player.subrank + '">' +
            '</div>' +
        '</td>' +
        '<td class="score-cell">' +
            '<span class="score-number">' + player.score.toLocaleString() + '</span>' +
        '</td>' +
        '</tr>'
    ).join('');
}

function updatePaginationInfo(pagination) {
    const paginationInfo = document.getElementById('pagination-info');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const paginationDiv = document.getElementById('pagination');
    
    // ëª¨ë“  ì§€ì—­ì—ì„œ ì‹¤ì œ API ì‚¬ìš©í•˜ë¯€ë¡œ í˜ì´ì§• ìˆ¨ê¸°ê¸°
    paginationDiv.style.display = 'none';
    return;
    
    totalPages = pagination.total_pages;
    currentPage = pagination.current_page;
    
    paginationInfo.textContent = currentPage + ' / ' + totalPages;
    prevBtn.disabled = currentPage === 1;
    nextBtn.disabled = currentPage === totalPages;
}

// Event listeners
document.getElementById('hero-filter').addEventListener('change', (e) => {
    currentFilters.hero = e.target.value;
    currentPage = 1;
    loadLeaderboardData();
});

document.getElementById('medal-filter').addEventListener('change', (e) => {
    currentFilters.medal = e.target.value;
    currentPage = 1;
    loadLeaderboardData();
});

document.getElementById('prev-btn').addEventListener('click', () => {
    if (currentPage > 1) {
        currentPage--;
        loadLeaderboardData();
    }
});

document.getElementById('next-btn').addEventListener('click', () => {
    if (currentPage < totalPages) {
        currentPage++;
        loadLeaderboardData();
    }
});

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    loadLeaderboardData();
});
</script>

<style>
.hero-link {
    display: inline-block;
    transition: all 0.3s ease;
    border-radius: 4px;
}

.hero-link:hover {
    transform: scale(1.1);
    filter: brightness(1.2);
    box-shadow: 0 4px 8px rgba(99, 162, 226, 0.3);
}

.hero-image {
    transition: all 0.3s ease;
    border-radius: 4px;
}

.heroes-list {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
}

.hero-item {
    position: relative;
}

.hero-link {
    text-decoration: none;
    cursor: pointer;
}
</style>