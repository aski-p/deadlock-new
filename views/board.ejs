<div class="board-section">
    <div class="board-container">
        <div class="board-header">
            <h1 class="page-title">ê²Œì‹œíŒ</h1>
            <% if (user) { %>
                <button class="write-post-btn" onclick="showWriteForm()">âœï¸ ê¸€ì“°ê¸°</button>
            <% } else { %>
                <p class="login-notice">ê¸€ì“°ê¸°ì™€ ëŒ“ê¸€ ì‘ì„±ì„ ìœ„í•´ì„œëŠ” <a href="/auth/steam" class="steam-login-link">Steam ë¡œê·¸ì¸</a>ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
            <% } %>
        </div>

        <!-- ê¸€ì“°ê¸° í¼ -->
        <div class="write-form-section" id="writeFormSection" style="display: none;">
            <div class="write-form">
                <h3>ìƒˆ ê¸€ ì‘ì„±</h3>
                <form id="writePostForm">
                    <div class="form-group">
                        <label for="postTitle">ì œëª©</label>
                        <input type="text" id="postTitle" name="title" required maxlength="100">
                    </div>
                    <div class="form-group">
                        <label for="postContent">ë‚´ìš©</label>
                        <textarea id="postContent" name="content" required rows="8" maxlength="2000"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="submit-btn">ì‘ì„±í•˜ê¸°</button>
                        <button type="button" class="cancel-btn" onclick="hideWriteForm()">ì·¨ì†Œ</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
        <div class="posts-container">
            <div class="posts-loading" id="postsLoading">
                <div class="loading-spinner"></div>
                <p>ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            
            <div class="posts-list" id="postsList" style="display: none;">
                <!-- ê²Œì‹œê¸€ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
            </div>
            
            <div class="pagination" id="pagination" style="display: none;">
                <button class="page-btn" id="prevBtn" onclick="changePage(-1)">ì´ì „</button>
                <span class="page-info" id="pageInfo">1 / 1</span>
                <button class="page-btn" id="nextBtn" onclick="changePage(1)">ë‹¤ìŒ</button>
            </div>
        </div>
    </div>
</div>

<style>
.board-section {
    padding: 120px 0 60px;
    min-height: 100vh;
    background: #000000;
    color: #FFEFD7;
}

.board-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 20px;
}

.board-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 40px;
    padding-bottom: 20px;
    border-bottom: 2px solid #63a2e2;
}

.page-title {
    font-size: 32px;
    font-weight: 700;
    color: #FFEFD7;
    margin: 0;
}

.write-post-btn {
    background: #63a2e2;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.write-post-btn:hover {
    background: #4f8bc9;
    transform: translateY(-2px);
}

.login-notice {
    color: #999;
    font-size: 14px;
}

.steam-login-link {
    color: #63a2e2;
    text-decoration: none;
}

.steam-login-link:hover {
    text-decoration: underline;
}

.write-form-section {
    background: rgba(255, 255, 255, 0.05);
    padding: 30px;
    border-radius: 12px;
    margin-bottom: 30px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.write-form h3 {
    margin-bottom: 20px;
    color: #63a2e2;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #FFEFD7;
}

.form-group input, .form-group textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.05);
    color: #FFEFD7;
    font-size: 14px;
    box-sizing: border-box;
}

.form-group input:focus, .form-group textarea:focus {
    outline: none;
    border-color: #63a2e2;
    background: rgba(255, 255, 255, 0.08);
}

.form-actions {
    display: flex;
    gap: 12px;
}

.submit-btn, .cancel-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.submit-btn {
    background: #63a2e2;
    color: white;
}

.submit-btn:hover {
    background: #4f8bc9;
}

.cancel-btn {
    background: rgba(255, 255, 255, 0.1);
    color: #FFEFD7;
}

.cancel-btn:hover {
    background: rgba(255, 255, 255, 0.15);
}

.posts-loading {
    text-align: center;
    padding: 60px 20px;
    color: #999;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid rgba(99, 162, 226, 0.3);
    border-left: 4px solid #63a2e2;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.post-item {
    background: rgba(255, 255, 255, 0.05);
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s;
    cursor: pointer;
}

.post-item:hover {
    background: rgba(99, 162, 226, 0.1);
    border-color: #63a2e2;
    transform: translateY(-2px);
}

.post-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.post-title {
    font-size: 18px;
    font-weight: 600;
    color: #FFEFD7;
    margin: 0;
}

.post-meta {
    display: flex;
    align-items: center;
    gap: 15px;
    font-size: 12px;
    color: #999;
}

.post-author {
    display: flex;
    align-items: center;
    gap: 8px;
}

.author-avatar {
    width: 24px;
    height: 24px;
    border-radius: 50%;
}

.post-content-preview {
    color: #ccc;
    font-size: 14px;
    line-height: 1.4;
    margin-bottom: 12px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.post-stats {
    display: flex;
    gap: 15px;
    font-size: 12px;
    color: #999;
}

.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: 40px;
}

.page-btn {
    background: #63a2e2;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s;
}

.page-btn:hover:not(:disabled) {
    background: #4f8bc9;
}

.page-btn:disabled {
    background: rgba(255, 255, 255, 0.1);
    color: #666;
    cursor: not-allowed;
}

.page-info {
    color: #FFEFD7;
    font-weight: 600;
}

/* ë°˜ì‘í˜• */
@media (max-width: 768px) {
    .board-header {
        flex-direction: column;
        gap: 20px;
        text-align: center;
    }
    
    .post-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
    
    .post-meta {
        flex-wrap: wrap;
    }
}
</style>

<script>
let currentPage = 1;
let totalPages = 1;

// í˜ì´ì§€ ë¡œë“œ ì‹œ ê²Œì‹œê¸€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
document.addEventListener('DOMContentLoaded', () => {
    loadPosts();
});

// ê²Œì‹œê¸€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
async function loadPosts(page = 1) {
    const loading = document.getElementById('postsLoading');
    const postsList = document.getElementById('postsList');
    const pagination = document.getElementById('pagination');
    
    loading.style.display = 'block';
    postsList.style.display = 'none';
    pagination.style.display = 'none';
    
    try {
        const response = await fetch(`/api/v1/board/posts?page=${page}&limit=10`);
        const data = await response.json();
        
        if (response.ok) {
            currentPage = data.currentPage;
            totalPages = data.totalPages;
            
            displayPosts(data.posts);
            updatePagination();
            
            loading.style.display = 'none';
            postsList.style.display = 'block';
            if (totalPages > 1) {
                pagination.style.display = 'flex';
            }
        } else {
            throw new Error(data.error || 'ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        }
    } catch (error) {
        console.error('ê²Œì‹œê¸€ ë¡œë”© ì˜¤ë¥˜:', error);
        loading.innerHTML = '<p style="color: #ff6b6b;">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
    }
}

// ê²Œì‹œê¸€ ëª©ë¡ í‘œì‹œ
function displayPosts(posts) {
    const postsList = document.getElementById('postsList');
    
    if (posts.length === 0) {
        postsList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
    }
    
    postsList.innerHTML = posts.map(post => `
        <div class="post-item" onclick="viewPost(${post.id})">
            <div class="post-header">
                <h3 class="post-title">${escapeHtml(post.title)}</h3>
                <div class="post-meta">
                    <div class="post-author">
                        <img src="${post.author.avatar}" alt="${post.author.username}" class="author-avatar" onerror="this.src='data:image/svg+xml;charset=utf-8,${encodeURIComponent('<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"24\\\" height=\\\"24\\\" viewBox=\\\"0 0 24 24\\\"><circle cx=\\\"12\\\" cy=\\\"12\\\" r=\\\"10\\\" fill=\\\"#666\\\" stroke=\\\"#fff\\\" stroke-width=\\\"2\\\"/><circle cx=\\\"12\\\" cy=\\\"10\\\" r=\\\"3\\\" fill=\\\"#fff\\\"/><path d=\\\"M6.5 17.5 Q12 15 17.5 17.5\\\" stroke=\\\"#fff\\\" stroke-width=\\\"2\\\" fill=\\\"none\\\"/></svg>')}'">
                        <span>${escapeHtml(post.author.username)}</span>
                    </div>
                    <span>${formatDate(post.created_at)}</span>
                </div>
            </div>
            <div class="post-content-preview">
                ${escapeHtml(post.content)}
            </div>
            <div class="post-stats">
                <span>ğŸ’¬ ëŒ“ê¸€ ${post.commentCount || 0}ê°œ</span>
            </div>
        </div>
    `).join('');
}

// í˜ì´ì§€ë„¤ì´ì…˜ ì—…ë°ì´íŠ¸
function updatePagination() {
    document.getElementById('pageInfo').textContent = `${currentPage} / ${totalPages}`;
    document.getElementById('prevBtn').disabled = currentPage === 1;
    document.getElementById('nextBtn').disabled = currentPage === totalPages;
}

// í˜ì´ì§€ ë³€ê²½
function changePage(direction) {
    const newPage = currentPage + direction;
    if (newPage >= 1 && newPage <= totalPages) {
        loadPosts(newPage);
    }
}

// ê¸€ì“°ê¸° í¼ í‘œì‹œ
function showWriteForm() {
    document.getElementById('writeFormSection').style.display = 'block';
    document.getElementById('postTitle').focus();
}

// ê¸€ì“°ê¸° í¼ ìˆ¨ê¸°ê¸°
function hideWriteForm() {
    document.getElementById('writeFormSection').style.display = 'none';
    document.getElementById('writePostForm').reset();
}

// ê²Œì‹œê¸€ ì‘ì„±
document.getElementById('writePostForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const title = document.getElementById('postTitle').value.trim();
    const content = document.getElementById('postContent').value.trim();
    
    if (!title || !content) {
        alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    try {
        const response = await fetch('/api/v1/board/posts', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ title, content })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            hideWriteForm();
            loadPosts(1); // ì²« í˜ì´ì§€ë¡œ ì´ë™
            alert('ê²Œì‹œê¸€ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
        } else {
            alert(data.error || 'ê²Œì‹œê¸€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    } catch (error) {
        console.error('ê²Œì‹œê¸€ ì‘ì„± ì˜¤ë¥˜:', error);
        alert('ê²Œì‹œê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
});

// ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸° (ì¶”í›„ êµ¬í˜„)
function viewPost(postId) {
    console.log('ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°:', postId);
    // ì¶”í›„ ëª¨ë‹¬ì´ë‚˜ ë³„ë„ í˜ì´ì§€ë¡œ êµ¬í˜„
}

// HTML ì´ìŠ¤ì¼€ì´í”„
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// ë‚ ì§œ í¬ë§·íŒ…
function formatDate(dateString) {
    const date = new Date(dateString);
    const now = new Date();
    const diff = now - date;
    
    const minutes = Math.floor(diff / 60000);
    const hours = Math.floor(diff / 3600000);
    const days = Math.floor(diff / 86400000);
    
    if (minutes < 1) return 'ë°©ê¸ˆ ì „';
    if (minutes < 60) return `${minutes}ë¶„ ì „`;
    if (hours < 24) return `${hours}ì‹œê°„ ì „`;
    if (days < 7) return `${days}ì¼ ì „`;
    
    return date.toLocaleDateString('ko-KR');
}
</script>