<div class="player-detail-section">
    <div class="player-detail-container">
        <!-- Welcome Message -->
        <div class="welcome-message">
            <h1>ì•ˆë…•í•˜ì„¸ìš”, <%= user.username %>ë‹˜! ğŸ‘‹</h1>
            <p>ë°ë“œë½ì—ì„œì˜ ì—¬ëŸ¬ë¶„ì˜ í™œì•½ì„ í™•ì¸í•´ë³´ì„¸ìš”!</p>
            <div class="quick-actions">
                <a href="/ko/leaderboards/asia" class="action-btn secondary">ğŸ† ë¦¬ë”ë³´ë“œ</a>
                <a href="<%= user.profileUrl || '#' %>" target="_blank" class="action-btn secondary">ğŸ® Steam</a>
            </div>
        </div>

        <!-- Loading State -->
        <div class="table-loading" id="player-loading">
            <div class="loading-spinner"></div>
            <p>í”Œë ˆì´ì–´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>

        <!-- Player Content -->
        <div class="player-content" id="player-content" style="display: none;">
            <!-- Player Header -->
            <div class="player-header">
                <div class="player-basic-info">
                    <img class="player-detail-avatar" id="player-avatar" alt="Player Avatar">
                    <div class="player-main-info">
                        <h1 class="player-name" id="player-name">í”Œë ˆì´ì–´</h1>
                        <div class="player-meta">
                            <span class="player-country" id="player-country">ğŸŒ</span>
                            <span class="player-account-id">ê³„ì • ID: <%= accountId %></span>
                        </div>
                    </div>
                </div>
                <div class="player-rank">
                    <div class="rank-badge">
                        <img class="rank-medal" id="rank-medal" alt="Rank Medal">
                        <div class="rank-info">
                            <span class="rank-name" id="rank-name">Oracle</span>
                            <span class="rank-score" id="rank-score">3500</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Player Stats -->
            <div class="player-stats">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-matches">0</div>
                        <div class="stat-label">ë§¤ì¹˜</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-winrate">0%</div>
                        <div class="stat-label">ìŠ¹ë¥ </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-lane-winrate">0%</div>
                        <div class="stat-label">ë¼ì¸ ìŠ¹ë¥ </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-kda">0.0</div>
                        <div class="stat-label">KDA</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-headshots">0%</div>
                        <div class="stat-label">í—¤ë“œìƒ·</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-souls">0</div>
                        <div class="stat-label">ì†Œìš¸/ë¶„</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-damage">0</div>
                        <div class="stat-label">ë°ë¯¸ì§€/ë¶„</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-healing">0</div>
                        <div class="stat-label">íë§/ë¶„</div>
                    </div>
                </div>
            </div>

            <!-- Heroes Section (ìµœê·¼ 10ê²Œì„ ê¸°ë°˜) -->
            <div class="player-section">
                <h2 class="section-title">í”Œë ˆì´í•œ ì˜ì›… (ìµœê·¼ 10ê²Œì„)</h2>
                <div class="heroes-grid" id="heroes-grid">
                    <!-- Heroes will be populated by JavaScript -->
                </div>
            </div>

            <!-- Recent Matches -->
            <div class="player-section">
                <h2 class="section-title">ìµœê·¼ ë§¤ì¹˜</h2>
                <div class="matches-list" id="matches-list">
                    <!-- Matches will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Error State -->
        <div class="profile-error" id="profile-error" style="display: none;">
            <h2>âš ï¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h2>
            <p>ë°ë“œë½ í†µê³„ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
            <p id="error-message" style="color: #EF4444; font-size: 14px; margin-top: 10px;"></p>
            <div style="margin-top: 20px;">
                <button onclick="loadMyProfileData()" class="retry-btn">ë‹¤ì‹œ ì‹œë„</button>
                <a href="/ko/leaderboards/asia" class="back-button" style="margin-left: 15px;">ë¦¬ë”ë³´ë“œ ë³´ê¸°</a>
            </div>
        </div>
    </div>
</div>

<style>
/* Welcome Message Styles */
.welcome-message {
    text-align: center;
    background: linear-gradient(135deg, rgba(88, 101, 242, 0.1) 0%, rgba(0, 0, 0, 0) 100%);
    padding: 30px;
    border-radius: 16px;
    margin-bottom: 30px;
    border: 1px solid rgba(88, 101, 242, 0.2);
}

.welcome-message h1 {
    font-size: 32px;
    font-weight: 700;
    color: #FFEFD7;
    margin: 0 0 10px 0;
}

.welcome-message p {
    color: #999;
    margin: 0 0 20px 0;
    font-size: 16px;
}

.quick-actions {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
}

.action-btn {
    padding: 8px 16px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    font-size: 14px;
    transition: all 0.3s;
}

.action-btn.secondary {
    background: rgba(255, 255, 255, 0.1);
    color: #FFEFD7;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.action-btn.secondary:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.3);
    transform: translateY(-1px);
}

/* Player Detail Styles (ê¸°ì¡´ CSS ì¬ì‚¬ìš©) */
.player-detail-section {
    padding: 120px 0 60px;
    min-height: 100vh;
    background: #000000;
}

.player-detail-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 40px;
}

/* ë§¤ì¹˜ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
.match-card {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    gap: 16px;
    transition: all 0.3s;
}

.match-card:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
}

.match-card.win {
    border-left: 4px solid #10B981;
}

.match-card.loss {
    border-left: 4px solid #EF4444;
}

.match-hero {
    display: flex;
    align-items: center;
    gap: 12px;
    min-width: 140px;
}

.match-hero-image {
    width: 48px;
    height: 48px;
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.match-hero-name {
    font-weight: 500;
    color: #FFEFD7;
}

.match-result {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 80px;
}

.result-text {
    font-weight: 600;
    font-size: 14px;
}

.win-text {
    color: #10B981;
}

.loss-text {
    color: #EF4444;
}

.match-duration {
    font-size: 12px;
    color: #999;
}

.match-stats {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 80px;
}

.kda {
    font-weight: 600;
    color: #FFEFD7;
    font-size: 14px;
}

.kda-ratio {
    font-size: 12px;
    color: #999;
}

.match-performance {
    display: flex;
    gap: 20px;
    flex: 1;
}

.performance-item {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.performance-label {
    font-size: 12px;
    color: #999;
    margin-bottom: 2px;
}

.performance-value {
    font-weight: 500;
    color: #FFEFD7;
    font-size: 14px;
}

.match-time {
    font-size: 12px;
    color: #999;
    min-width: 80px;
    text-align: right;
}

/* ë°˜ì‘í˜• */
@media (max-width: 768px) {
    .player-detail-container {
        padding: 0 20px;
    }
    
    .welcome-message h1 {
        font-size: 24px;
    }
    
    .quick-actions {
        flex-direction: column;
        align-items: center;
    }
    
    .match-card {
        flex-direction: column;
        gap: 12px;
        text-align: center;
    }
    
    .match-hero, .match-result, .match-stats {
        min-width: auto;
    }
    
    .match-performance {
        justify-content: center;
    }
    
    .match-time {
        text-align: center;
        min-width: auto;
    }
}
</style>

<script>
async function loadMyProfileData() {
    const loading = document.getElementById('player-loading');
    const content = document.getElementById('player-content');
    const error = document.getElementById('profile-error');
    
    loading.style.display = 'flex';
    content.style.display = 'none';
    error.style.display = 'none';
    
    try {
        const response = await fetch(`/api/v1/players/<%= accountId %>`);
        const data = await response.json();
        
        if (response.ok) {
            updatePlayerUI(data);
            loading.style.display = 'none';
            content.style.display = 'block';
        } else {
            throw new Error(data.error || 'Failed to load profile');
        }
        
    } catch (err) {
        console.error('Failed to load profile data:', err);
        loading.style.display = 'none';
        error.style.display = 'block';
        
        // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
        const errorMessageEl = document.getElementById('error-message');
        if (errorMessageEl) {
            errorMessageEl.textContent = `ì˜¤ë¥˜ ìƒì„¸: ${err.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`;
        }
    }
}

function updatePlayerUI(player) {
    // Basic Info
    document.getElementById('player-avatar').src = player.avatar;
    document.getElementById('player-name').textContent = player.name;
    document.getElementById('player-country').textContent = player.country;
    
    // Rank
    const getMedalImage = (medal, subrank) => {
        const medalRankMap = {
            'Eternus': 11, 'Phantom': 10, 'Oracle': 9, 'Ritualist': 8,
            'Alchemist': 7, 'Arcanist': 6, 'Initiate': 5
        };
        const rankNumber = medalRankMap[medal] || 9;
        return `https://cdn.deadlock.coach/vpk/panorama/images/ranked/badges/rank${rankNumber}/badge_sm_subrank${subrank}.webp`;
    };
    
    document.getElementById('rank-medal').src = getMedalImage(player.rank.medal, player.rank.subrank);
    document.getElementById('rank-name').textContent = `${player.rank.medal} ${player.rank.subrank}`;
    document.getElementById('rank-score').textContent = player.rank.score.toLocaleString();
    
    // Stats
    document.getElementById('stat-matches').textContent = player.stats.matches;
    document.getElementById('stat-winrate').textContent = `${player.stats.winRate}%`;
    document.getElementById('stat-lane-winrate').textContent = `${player.stats.laneWinRate}%`;
    document.getElementById('stat-kda').textContent = player.stats.kda;
    document.getElementById('stat-headshots').textContent = `${player.stats.headshotPercent}%`;
    document.getElementById('stat-souls').textContent = player.stats.soulsPerMin.toLocaleString();
    document.getElementById('stat-damage').textContent = player.stats.damagePerMin.toLocaleString();
    document.getElementById('stat-healing').textContent = player.stats.healingPerMin.toLocaleString();
    
    // ì˜ì›…ë³„ ìŠ¤íƒ¯ ë¡œë“œ
    loadHeroStats(player.accountId);
    
    // ë§¤ì¹˜ íˆìŠ¤í† ë¦¬ ë¡œë“œ
    loadMatchHistory(player.accountId);
}

// ì˜ì›…ë³„ ìŠ¤íƒ¯ ë¡œë“œ
async function loadHeroStats(accountId) {
    const grid = document.getElementById('heroes-grid');
    
    try {
        const response = await fetch(`/api/v1/players/${accountId}/hero-stats`);
        const heroStats = await response.json();
        
        if (response.ok && heroStats.length > 0) {
            displayHeroStats(heroStats);
        } else {
            throw new Error('ì˜ì›… ìŠ¤íƒ¯ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        }
    } catch (error) {
        console.error('ì˜ì›… ìŠ¤íƒ¯ ë¡œë“œ ì‹¤íŒ¨:', error);
        grid.innerHTML = '<p style="color: #999; text-align: center;">ì˜ì›… ìŠ¤íƒ¯ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
    }
}

// ì˜ì›… ìŠ¤íƒ¯ í‘œì‹œ
function displayHeroStats(heroStats) {
    const grid = document.getElementById('heroes-grid');
    
    const getHeroImage = (heroName) => {
        const heroImageMap = {
            'Abrams': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/bull_card.webp',
            'Bebop': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/bebop_card.webp',
            'Dynamo': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/dynamo_card.webp',
            'Grey Talon': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/archer_card.webp',
            'Haze': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/haze_card.webp',
            'Infernus': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/inferno_card.webp',
            'Ivy': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/ivy_card.webp',
            'Kelvin': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/kelvin_card.webp',
            'Lady Geist': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/spectre_card.webp',
            'Lash': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/lash_card.webp',
            'McGinnis': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/engineer_card.webp',
            'Mo & Krill': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/digger_card.webp',
            'Paradox': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/chrono_card.webp',
            'Pocket': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/synth_card.webp',
            'Seven': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/gigawatt_card.webp',
            'Shiv': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/shiv_card.webp',
            'Vindicta': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/magician_card.webp',
            'Viscous': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/viscous_card.webp',
            'Warden': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/warden_card.webp',
            'Wraith': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/wraith_card.webp',
            'Yamato': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/yamato_card.webp'
        };
        return heroImageMap[heroName] || 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/bull_card.webp';
    };
    
    grid.innerHTML = heroStats.map(hero => `
        <div class="hero-card">
            <img src="${getHeroImage(hero.hero)}" alt="${hero.hero}" class="hero-card-image">
            <div class="hero-card-info">
                <h3>${hero.hero}</h3>
                <div class="hero-card-stats">
                    ${hero.matches}ê²Œì„ Â· ${hero.winRate}% ìŠ¹ë¥ <br>
                    <small style="color: #999;">KDA: ${hero.avgKda} Â· ì†Œìš¸/ë¶„: ${hero.avgSouls}</small>
                </div>
            </div>
        </div>
    `).join('');
}

// ë§¤ì¹˜ íˆìŠ¤í† ë¦¬ ë¡œë“œ
async function loadMatchHistory(accountId) {
    const matchesList = document.getElementById('matches-list');
    
    try {
        const response = await fetch(`/api/v1/players/${accountId}/match-history?limit=20`);
        const matches = await response.json();
        
        if (response.ok && matches.length > 0) {
            displayMatchHistory(matches);
        } else {
            throw new Error('ë§¤ì¹˜ íˆìŠ¤í† ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        }
    } catch (error) {
        console.error('ë§¤ì¹˜ íˆìŠ¤í† ë¦¬ ë¡œë“œ ì‹¤íŒ¨:', error);
        matchesList.innerHTML = '<p style="color: #999; text-align: center;">ë§¤ì¹˜ íˆìŠ¤í† ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
    }
}

// ë§¤ì¹˜ íˆìŠ¤í† ë¦¬ í‘œì‹œ
function displayMatchHistory(matches) {
    const matchesList = document.getElementById('matches-list');
    
    const getHeroImage = (heroName) => {
        const heroImageMap = {
            'Abrams': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/bull_card.webp',
            'Bebop': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/bebop_card.webp',
            'Dynamo': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/dynamo_card.webp',
            'Grey Talon': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/archer_card.webp',
            'Haze': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/haze_card.webp',
            'Infernus': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/inferno_card.webp',
            'Ivy': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/ivy_card.webp',
            'Kelvin': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/kelvin_card.webp',
            'Lady Geist': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/spectre_card.webp',
            'Lash': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/lash_card.webp',
            'McGinnis': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/engineer_card.webp',
            'Mo & Krill': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/digger_card.webp',
            'Paradox': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/chrono_card.webp',
            'Pocket': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/synth_card.webp',
            'Seven': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/gigawatt_card.webp',
            'Shiv': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/shiv_card.webp',
            'Vindicta': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/magician_card.webp',
            'Viscous': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/viscous_card.webp',
            'Warden': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/warden_card.webp',
            'Wraith': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/wraith_card.webp',
            'Yamato': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/yamato_card.webp'
        };
        return heroImageMap[heroName] || 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/bull_card.webp';
    };
    
    const formatDate = (dateString) => {
        const date = new Date(dateString);
        const now = new Date();
        const diffHours = Math.floor((now - date) / (1000 * 60 * 60));
        
        if (diffHours < 1) return 'ë°©ê¸ˆ ì „';
        if (diffHours < 24) return `${diffHours}ì‹œê°„ ì „`;
        const diffDays = Math.floor(diffHours / 24);
        if (diffDays < 7) return `${diffDays}ì¼ ì „`;
        return date.toLocaleDateString('ko-KR');
    };
    
    matchesList.innerHTML = matches.map(match => `
        <div class="match-card ${match.result === 'ìŠ¹ë¦¬' ? 'win' : 'loss'}">
            <div class="match-hero">
                <img src="${getHeroImage(match.hero)}" alt="${match.hero}" class="match-hero-image">
                <span class="match-hero-name">${match.hero}</span>
            </div>
            <div class="match-result">
                <span class="result-text ${match.result === 'ìŠ¹ë¦¬' ? 'win-text' : 'loss-text'}">${match.result}</span>
                <span class="match-duration">${match.durationFormatted}</span>
            </div>
            <div class="match-stats">
                <span class="kda">${match.kills}/${match.deaths}/${match.assists}</span>
                <span class="kda-ratio">KDA: ${match.kda}</span>
            </div>
            <div class="match-performance">
                <div class="performance-item">
                    <span class="performance-label">ì†Œìš¸</span>
                    <span class="performance-value">${match.souls.toLocaleString()}</span>
                </div>
                <div class="performance-item">
                    <span class="performance-label">ë°ë¯¸ì§€</span>
                    <span class="performance-value">${match.damage.toLocaleString()}</span>
                </div>
            </div>
            <div class="match-time">
                ${formatDate(match.playedAt)}
            </div>
        </div>
    `).join('');
}


// Load data when page loads
document.addEventListener('DOMContentLoaded', loadMyProfileData);
</script>