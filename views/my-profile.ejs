<div class="player-detail-section">
    <div class="player-detail-container">
        <!-- Welcome Message -->
        <div class="welcome-message">
            <h1>ì•ˆë…•í•˜ì„¸ìš”, <%= user.username %>ë‹˜! ğŸ‘‹</h1>
            <p>ë°ë“œë½ì—ì„œì˜ ì—¬ëŸ¬ë¶„ì˜ í™œì•½ì„ í™•ì¸í•´ë³´ì„¸ìš”!</p>
            <div class="quick-actions">
                <a href="/ko/leaderboards/asia" class="action-btn secondary">ğŸ† ë¦¬ë”ë³´ë“œ</a>
                <a href="<%= user.profileUrl || '#' %>" target="_blank" class="action-btn secondary">ğŸ® Steam</a>
            </div>
        </div>

        <!-- Loading State -->
        <div class="table-loading" id="player-loading">
            <div class="loading-spinner"></div>
            <p>í”Œë ˆì´ì–´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>

        <!-- Player Content -->
        <div class="player-content" id="player-content" style="display: none;">
            <!-- Player Header -->
            <div class="player-header">
                <div class="player-basic-info">
                    <img class="player-detail-avatar" id="player-avatar" alt="Player Avatar">
                    <div class="player-main-info">
                        <h1 class="player-name" id="player-name">í”Œë ˆì´ì–´</h1>
                        <div class="player-meta">
                            <span class="player-country" id="player-country">ğŸŒ</span>
                            <span class="player-account-id">ê³„ì • ID: <%= accountId %></span>
                            <% if (user && user.steamId) { %>
                            <span class="player-steam-id">Steam ID: <%= user.steamId %></span>
                            <% } %>
                        </div>
                    </div>
                </div>
                <div class="player-rank">
                    <div class="rank-badge">
                        <img class="rank-medal" id="rank-medal" alt="Rank Medal">
                        <div class="rank-info">
                            <span class="rank-name" id="rank-name">Oracle</span>
                            <span class="rank-score" id="rank-score">3500</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Player Stats -->
            <div class="player-stats">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-matches">0</div>
                        <div class="stat-label">ë§¤ì¹˜</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-winrate">0%</div>
                        <div class="stat-label">ìŠ¹ë¥ </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-lane-winrate">0%</div>
                        <div class="stat-label">ë¼ì¸ ìŠ¹ë¥ </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-kda">0.0</div>
                        <div class="stat-label">KDA</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-souls">0</div>
                        <div class="stat-label">ì†Œìš¸/ë¶„</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-denies">0</div>
                        <div class="stat-label">ë””ë‚˜ì´</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-endorsements">0</div>
                        <div class="stat-label">ì¶”ì²œìˆ˜</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-duration">0:00</div>
                        <div class="stat-label">í‰ê·  ë§¤ì¹˜ ì‹œê°„</div>
                    </div>
                </div>
            </div>

            <!-- Heroes Section (ì „ì²´ ê²Œì„ ê¸°ë°˜) -->
            <div class="player-section">
                <h2 class="section-title">í”Œë ˆì´í•œ ì˜ì›… (ì „ì²´ ê²Œì„)</h2>
                <p class="section-note">
                    <i class="fas fa-info-circle"></i>
                    ì˜ì›… í†µê³„ëŠ” ì™¸ë¶€ API ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°, ì‹¤ì œ ê²Œì„ ë‚´ ë°ì´í„°ì™€ ì•½ê°„ì˜ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
                    ë°ì´í„°ëŠ” ì£¼ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
                </p>
                <div class="heroes-grid" id="heroes-grid">
                    <!-- Heroes will be populated by JavaScript -->
                </div>
            </div>

            <!-- Recent Matches -->
            <div class="player-section">
                <h2 class="section-title">ìµœê·¼ ë§¤ì¹˜</h2>
                <div class="matches-list" id="matches-list">
                    <!-- Matches will be populated by JavaScript -->
                </div>
            </div>

            <!-- Party Stats -->
            <div class="player-section">
                <h2 class="section-title">íŒŒí‹° í†µê³„ (í•¨ê»˜ í”Œë ˆì´í•œ íŒ€ì›)</h2>
                <div class="party-stats-list" id="party-stats-list">
                    <!-- Party stats will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Error State -->
        <div class="profile-error" id="profile-error" style="display: none;">
            <h2>âš ï¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h2>
            <p>ë°ë“œë½ í†µê³„ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
            <p id="error-message" style="color: #EF4444; font-size: 14px; margin-top: 10px;"></p>
            <div style="margin-top: 20px;">
                <button onclick="loadMyProfileData()" class="retry-btn">ë‹¤ì‹œ ì‹œë„</button>
                <a href="/ko/leaderboards/asia" class="back-button" style="margin-left: 15px;">ë¦¬ë”ë³´ë“œ ë³´ê¸°</a>
            </div>
        </div>
    </div>
</div>

<style>
/* Welcome Message Styles */
.welcome-message {
    text-align: center;
    background: linear-gradient(135deg, rgba(88, 101, 242, 0.1) 0%, rgba(0, 0, 0, 0) 100%);
    padding: 30px;
    border-radius: 16px;
    margin-bottom: 30px;
    border: 1px solid rgba(88, 101, 242, 0.2);
}

.welcome-message h1 {
    font-size: 32px;
    font-weight: 700;
    color: #FFEFD7;
    margin: 0 0 10px 0;
}

.welcome-message p {
    color: #999;
    margin: 0 0 20px 0;
    font-size: 16px;
}

.quick-actions {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
}

.action-btn {
    padding: 8px 16px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    font-size: 14px;
    transition: all 0.3s;
}

.action-btn.secondary {
    background: rgba(255, 255, 255, 0.1);
    color: #FFEFD7;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.action-btn.secondary:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.3);
    transform: translateY(-1px);
}

/* Player Detail Styles (ê¸°ì¡´ CSS ì¬ì‚¬ìš©) */
.player-detail-section {
    padding: 120px 0 60px;
    min-height: 100vh;
    background: #000000;
}

.player-detail-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 40px;
}

/* í”Œë ˆì´ì–´ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
.player-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(255, 255, 255, 0.05);
    padding: 40px;
    border-radius: 16px;
    margin-bottom: 40px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.player-basic-info {
    display: flex;
    align-items: center;
    gap: 20px;
}

.player-detail-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    border: 3px solid #63a2e2;
}

.player-main-info {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.player-name {
    font-size: 32px;
    font-weight: 700;
    color: #FFEFD7;
    margin: 0;
}

.player-meta {
    display: flex;
    align-items: center;
    gap: 15px;
    font-size: 16px;
    color: #999;
}

.player-country {
    font-size: 24px;
}

.player-account-id {
    font-family: monospace;
    font-size: 14px;
}

.player-rank {
    text-align: center;
}

.rank-badge {
    display: flex;
    align-items: center;
    gap: 15px;
}

.rank-medal {
    width: 64px;
    height: 64px;
}

.rank-info {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.rank-name {
    font-size: 18px;
    font-weight: 600;
    color: #63a2e2;
}

.rank-score {
    font-size: 24px;
    font-weight: 700;
    color: #FFEFD7;
}

.player-stats {
    background: rgba(255, 255, 255, 0.05);
    padding: 40px;
    border-radius: 16px;
    margin-bottom: 40px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 30px;
}

.stat-card {
    text-align: center;
    padding: 20px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s;
}

.stat-card:hover {
    background: rgba(99, 162, 226, 0.1);
    border-color: #63a2e2;
    transform: translateY(-2px);
}

.stat-value {
    font-size: 28px;
    font-weight: 700;
    color: #63a2e2;
    margin-bottom: 8px;
    display: block;
}

.stat-label {
    font-size: 14px;
    color: #999;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.player-section {
    background: rgba(255, 255, 255, 0.05);
    padding: 40px;
    border-radius: 16px;
    margin-bottom: 40px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.section-title {
    font-size: 24px;
    font-weight: 600;
    color: #FFEFD7;
    margin-bottom: 30px;
    border-bottom: 2px solid #63a2e2;
    padding-bottom: 10px;
}

.heroes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.hero-card {
    display: flex;
    align-items: center;
    gap: 15px;
    background: rgba(255, 255, 255, 0.03);
    padding: 20px;
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s;
}

.hero-card:hover {
    background: rgba(99, 162, 226, 0.1);
    border-color: #63a2e2;
    transform: translateY(-2px);
}

.hero-card-image {
    width: 50px;
    height: 50px;
    border-radius: 8px;
}

.hero-card-info h3 {
    font-size: 16px;
    font-weight: 600;
    color: #FFEFD7;
    margin: 0 0 5px 0;
}

.hero-card-stats {
    font-size: 14px;
    color: #999;
}

/* ìƒì„¸ ì˜ì›… ì¹´ë“œ ìŠ¤íƒ€ì¼ */
.hero-card.detailed {
    flex-direction: column;
    align-items: stretch;
    padding: 25px;
    min-height: 300px;
}

.hero-card.detailed .hero-card-image {
    width: 60px;
    height: 60px;
    align-self: center;
    margin-bottom: 15px;
}

.hero-card-name {
    text-align: center;
    font-size: 18px;
    font-weight: 700;
    color: #FFEFD7;
    margin: 0 0 20px 0;
}

.hero-card-main-stats {
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.hero-card-detailed-stats {
    flex: 1;
}

.hero-stat-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    font-size: 13px;
}

.hero-stat-label {
    color: #999;
    font-weight: 500;
}

.hero-stat-value {
    color: #FFEFD7;
    font-weight: 600;
}

.hero-stat-value.positive {
    color: #10B981;
}

.hero-stat-value.negative {
    color: #EF4444;
}

/* ë§¤ì¹˜ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
.matches-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.match-card {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(255, 255, 255, 0.03);
    padding: 20px;
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s;
}

.match-card:hover {
    background: rgba(99, 162, 226, 0.1);
    border-color: #63a2e2;
}

.match-card.win {
    border-left: 4px solid #10B981;
}

.match-card.loss {
    border-left: 4px solid #EF4444;
}

.match-hero {
    display: flex;
    align-items: center;
    gap: 15px;
    min-width: 140px;
}

.match-hero-image {
    width: 40px;
    height: 40px;
    border-radius: 6px;
}

.match-hero-name {
    font-weight: 500;
    color: #FFEFD7;
}

.match-result {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 80px;
}

.result-text {
    font-weight: 600;
    font-size: 14px;
}

.win-text {
    color: #10B981;
}

.loss-text {
    color: #EF4444;
}

.unknown-text {
    color: #999;
}

.match-outcomes {
    display: flex;
    flex-direction: column;
    gap: 2px;
    margin-bottom: 4px;
}

.match-outcome {
    font-weight: 600;
    font-size: 13px;
}

.lane-outcome {
    font-weight: 500;
    font-size: 11px;
}

.match-duration {
    font-size: 12px;
    color: #999;
}

.match-id {
    font-size: 11px;
    color: #666;
    font-family: monospace;
}

.match-stats {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 80px;
}

.kda {
    font-family: monospace;
    font-size: 16px;
    color: #FFEFD7;
}

.kda-ratio {
    font-size: 12px;
    color: #999;
}

.match-performance {
    display: flex;
    gap: 20px;
    flex: 1;
}

.performance-item {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.performance-label {
    font-size: 12px;
    color: #999;
    margin-bottom: 2px;
}

.performance-value {
    font-weight: 500;
    color: #FFEFD7;
    font-size: 14px;
}

.match-time {
    font-size: 12px;
    color: #999;
    min-width: 80px;
    text-align: right;
}

/* íŒŒí‹° ìŠ¤íƒ¯ ìŠ¤íƒ€ì¼ */
.party-stats-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.party-member {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px 20px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s;
    cursor: pointer;
}

.party-member:hover {
    background: rgba(99, 162, 226, 0.1);
    border-color: #63a2e2;
    transform: translateX(5px);
}

.party-member:active {
    background: rgba(99, 162, 226, 0.15);
    border-color: #5289c7;
    transform: translateX(3px) scale(0.98);
}

.party-member-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    overflow: hidden;
    flex-shrink: 0;
}

.party-member-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.party-member-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.party-member-name {
    font-weight: 600;
    color: #FFEFD7;
    font-size: 16px;
}

.party-member-matches {
    font-size: 14px;
    color: #999;
}

.party-member-winrate {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    min-width: 80px;
}

.winrate-value {
    font-size: 20px;
    font-weight: 700;
    color: #63a2e2;
}

.winrate-label {
    font-size: 12px;
    color: #999;
    text-transform: uppercase;
}

.party-member-id {
    font-size: 12px;
    color: #999;
    font-family: monospace;
}

.party-stats {
    display: flex;
    gap: 25px;
    flex: 1;
}

.party-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.party-stat-label {
    font-size: 12px;
    color: #999;
    margin-bottom: 4px;
}

.party-stat-value {
    font-weight: 600;
    color: #63a2e2;
    font-size: 14px;
}

.party-last-played {
    font-size: 12px;
    color: #999;
    min-width: 100px;
    text-align: right;
}

/* ì—ëŸ¬ ë° ë¡œë”© ìŠ¤íƒ€ì¼ */
.profile-error {
    text-align: center;
    padding: 100px 20px;
    color: #FFEFD7;
}

.profile-error h2 {
    font-size: 36px;
    margin-bottom: 20px;
    color: #EF4444;
}

.retry-btn {
    background: #63a2e2;
    color: white;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.retry-btn:hover {
    background: #5289c7;
    transform: translateY(-2px);
}

.back-button {
    display: inline-block;
    background: rgba(255, 255, 255, 0.1);
    color: #FFEFD7;
    padding: 12px 24px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s;
}

.back-button:hover {
    background: rgba(255, 255, 255, 0.2);
    color: #FFEFD7;
}

/* íŒ€ ë­í¬ ë°°ì§€ ìŠ¤íƒ€ì¼ */
.match-meta-info {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 4px 0;
}

.team-rank-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    position: relative;
}

.rank-badge-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
}

.rank-fallback {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    border-radius: 6px;
    font-weight: bold;
    font-size: 12px;
    color: white;
    background: linear-gradient(135deg, #63a2e2, #4a90e2);
    border: 2px solid #63a2e2;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
    line-height: 1;
}

/* íŒ€ ë­í¬ í˜¸ë²„ íš¨ê³¼ */
.team-rank-badge:hover {
    transform: scale(1.1);
    transition: transform 0.2s ease;
}

.team-rank-badge:hover .rank-badge-image {
    filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.5)) brightness(1.1);
}

/* ë°˜ì‘í˜• */
@media (max-width: 768px) {
    .player-detail-container {
        padding: 0 20px;
    }
    
    .welcome-message h1 {
        font-size: 24px;
    }
    
    .quick-actions {
        flex-direction: column;
        align-items: center;
    }
    
    .player-header {
        flex-direction: column;
        gap: 20px;
        text-align: center;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }
    
    .heroes-grid {
        grid-template-columns: 1fr;
    }
    
    .match-card {
        flex-direction: column;
        gap: 12px;
        text-align: center;
    }
    
    .match-hero, .match-result, .match-stats {
        min-width: auto;
    }
    
    .match-performance {
        justify-content: center;
    }
    
    .match-time {
        text-align: center;
        min-width: auto;
    }
    
    .match-meta-info {
        flex-direction: column;
        gap: 5px;
        align-items: center;
    }
    
    .team-rank-badge {
        width: 24px;
        height: 24px;
    }
    
    .rank-fallback {
        width: 20px;
        height: 20px;
        font-size: 10px;
    }
    
    .party-member {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
    
    .party-member-info {
        min-width: auto;
    }
    
    .party-stats {
        justify-content: center;
        flex-wrap: wrap;
        gap: 15px;
    }
    
    .party-last-played {
        text-align: center;
        min-width: auto;
    }
}
</style>

<script>
// êµ­ê°€ í”Œë˜ê·¸ë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
function getCountryImage(countryFlag) {
    const flagImageMap = {
        'ğŸ‡ºğŸ‡¸': '<img src="https://flagcdn.com/24x18/us.png" alt="ë¯¸êµ­" title="ë¯¸êµ­" class="flag-image">',
        'ğŸ‡¨ğŸ‡¦': '<img src="https://flagcdn.com/24x18/ca.png" alt="ìºë‚˜ë‹¤" title="ìºë‚˜ë‹¤" class="flag-image">',
        'ğŸ‡²ğŸ‡½': '<img src="https://flagcdn.com/24x18/mx.png" alt="ë©•ì‹œì½”" title="ë©•ì‹œì½”" class="flag-image">',
        'ğŸ‡¬ğŸ‡§': '<img src="https://flagcdn.com/24x18/gb.png" alt="ì˜êµ­" title="ì˜êµ­" class="flag-image">',
        'ğŸ‡©ğŸ‡ª': '<img src="https://flagcdn.com/24x18/de.png" alt="ë…ì¼" title="ë…ì¼" class="flag-image">',
        'ğŸ‡«ğŸ‡·': '<img src="https://flagcdn.com/24x18/fr.png" alt="í”„ë‘ìŠ¤" title="í”„ë‘ìŠ¤" class="flag-image">',
        'ğŸ‡ªğŸ‡¸': '<img src="https://flagcdn.com/24x18/es.png" alt="ìŠ¤í˜ì¸" title="ìŠ¤í˜ì¸" class="flag-image">',
        'ğŸ‡®ğŸ‡¹': '<img src="https://flagcdn.com/24x18/it.png" alt="ì´íƒˆë¦¬ì•„" title="ì´íƒˆë¦¬ì•„" class="flag-image">',
        'ğŸ‡¨ğŸ‡³': '<img src="https://flagcdn.com/24x18/cn.png" alt="ì¤‘êµ­" title="ì¤‘êµ­" class="flag-image">',
        'ğŸ‡¯ğŸ‡µ': '<img src="https://flagcdn.com/24x18/jp.png" alt="ì¼ë³¸" title="ì¼ë³¸" class="flag-image">',
        'ğŸ‡°ğŸ‡·': '<img src="https://flagcdn.com/24x18/kr.png" alt="í•œêµ­" title="í•œêµ­" class="flag-image">',
        'ğŸ‡¹ğŸ‡¼': '<img src="https://flagcdn.com/24x18/tw.png" alt="ëŒ€ë§Œ" title="ëŒ€ë§Œ" class="flag-image">',
        'ğŸ‡¸ğŸ‡¬': '<img src="https://flagcdn.com/24x18/sg.png" alt="ì‹±ê°€í¬ë¥´" title="ì‹±ê°€í¬ë¥´" class="flag-image">',
        'ğŸ‡·ğŸ‡º': '<img src="https://flagcdn.com/24x18/ru.png" alt="ëŸ¬ì‹œì•„" title="ëŸ¬ì‹œì•„" class="flag-image">',
        'ğŸ‡µğŸ‡±': '<img src="https://flagcdn.com/24x18/pl.png" alt="í´ë€ë“œ" title="í´ë€ë“œ" class="flag-image">',
        'ğŸ‡¸ğŸ‡ª': '<img src="https://flagcdn.com/24x18/se.png" alt="ìŠ¤ì›¨ë´" title="ìŠ¤ì›¨ë´" class="flag-image">',
        'ğŸ‡³ğŸ‡´': '<img src="https://flagcdn.com/24x18/no.png" alt="ë…¸ë¥´ì›¨ì´" title="ë…¸ë¥´ì›¨ì´" class="flag-image">',
        'ğŸ‡©ğŸ‡°': '<img src="https://flagcdn.com/24x18/dk.png" alt="ë´ë§ˆí¬" title="ë´ë§ˆí¬" class="flag-image">',
        'ğŸ‡¹ğŸ‡­': '<img src="https://flagcdn.com/24x18/th.png" alt="íƒœêµ­" title="íƒœêµ­" class="flag-image">',
        'ğŸ‡»ğŸ‡³': '<img src="https://flagcdn.com/24x18/vn.png" alt="ë² íŠ¸ë‚¨" title="ë² íŠ¸ë‚¨" class="flag-image">',
        'ğŸ‡²ğŸ‡¾': '<img src="https://flagcdn.com/24x18/my.png" alt="ë§ë ˆì´ì‹œì•„" title="ë§ë ˆì´ì‹œì•„" class="flag-image">',
        'ğŸ‡µğŸ‡­': '<img src="https://flagcdn.com/24x18/ph.png" alt="í•„ë¦¬í•€" title="í•„ë¦¬í•€" class="flag-image">',
        'ğŸ‡®ğŸ‡©': '<img src="https://flagcdn.com/24x18/id.png" alt="ì¸ë„ë„¤ì‹œì•„" title="ì¸ë„ë„¤ì‹œì•„" class="flag-image">',
        'ğŸŒ': '<img src="https://flagcdn.com/24x18/un.png" alt="ì•Œ ìˆ˜ ì—†ìŒ" title="ì•Œ ìˆ˜ ì—†ìŒ" class="flag-image">'
    };
    
    return flagImageMap[countryFlag] || '<img src="https://flagcdn.com/24x18/un.png" alt="ì•Œ ìˆ˜ ì—†ìŒ" title="ì•Œ ìˆ˜ ì—†ìŒ" class="flag-image">';
}

async function loadMyProfileData() {
    const loading = document.getElementById('player-loading');
    const content = document.getElementById('player-content');
    const error = document.getElementById('profile-error');
    
    loading.style.display = 'flex';
    content.style.display = 'none';
    error.style.display = 'none';
    
    try {
        const accountId = '<%= accountId %>';
        console.log('ğŸ“‹ í”„ë¡œí•„ ë°ì´í„° ë¡œë”© ì‹œì‘, Account ID:', accountId);
        
        // accountId ìœ íš¨ì„± ê²€ì‚¬
        if (!accountId || accountId === 'null' || accountId === 'undefined') {
            throw new Error('Account IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
        }
        
        // ë³‘ë ¬ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ë™ì‹œì— ë¡œë“œ
        console.log('ğŸ”„ API í˜¸ì¶œ ì‹œì‘...');
        const [playerResponse, heroStatsResponse, matchHistoryResponse, partyStatsResponse] = await Promise.all([
            fetch(`/api/v1/players/${accountId}?refresh=true`),
            fetch(`/api/v1/players/${accountId}/hero-stats?refresh=true`),
            fetch(`/api/v1/players/${accountId}/match-history?limit=10&refresh=true`),
            fetch(`/api/v1/players/${accountId}/party-stats?refresh=true`)
        ]);
        
        console.log('ğŸ“¡ API ì‘ë‹µ ìƒíƒœ:', {
            player: playerResponse.status,
            heroStats: heroStatsResponse.status,
            matchHistory: matchHistoryResponse.status,
            partyStats: partyStatsResponse.status
        });
        
        const [playerData, heroStats, matchHistory, partyStats] = await Promise.all([
            playerResponse.json(),
            heroStatsResponse.json(),
            matchHistoryResponse.json(),
            partyStatsResponse.json()
        ]);
        
        console.log('ğŸ“Š ë°›ì€ ë°ì´í„°:', {
            player: !!playerData,
            heroStats: heroStats?.length || 0,
            matchHistory: matchHistory?.length || 0,
            partyStats: partyStats?.length || 0
        });
        
        if (playerResponse.ok && playerData) {
            // ë¹ ë¥¸ UI ì—…ë°ì´íŠ¸
            updatePlayerUIFast(playerData, heroStats, matchHistory, partyStats);
            loading.style.display = 'none';
            content.style.display = 'block';
            console.log('âœ… í”„ë¡œí•„ ë°ì´í„° ë¡œë”© ì™„ë£Œ');
        } else {
            throw new Error(playerData?.error || `í”Œë ˆì´ì–´ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨ (ìƒíƒœ: ${playerResponse.status})`);
        }
        
    } catch (err) {
        console.error('âŒ í”„ë¡œí•„ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', err);
        loading.style.display = 'none';
        error.style.display = 'block';
        
        const errorMessageEl = document.getElementById('error-message');
        if (errorMessageEl) {
            errorMessageEl.textContent = `ì˜¤ë¥˜ ìƒì„¸: ${err.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`;
        }
    }
}

// ë¹ ë¥¸ UI ì—…ë°ì´íŠ¸ - ëª¨ë“  ë°ì´í„°ë¥¼ í•œ ë²ˆì— ì²˜ë¦¬
function updatePlayerUIFast(player, heroStats, matchHistory, partyStats) {
    console.log('ğŸ¨ UI ì—…ë°ì´íŠ¸ ì‹œì‘, í”Œë ˆì´ì–´ ë°ì´í„°:', player);
    
    try {
        // Basic Info (ì•ˆì „í•œ ì ‘ê·¼)
        const avatar = player?.avatar || 'https://avatars.cloudflare.steamstatic.com/b5bd56c1aa4644a474a2e4972be27ef9e82e517e_full.jpg';
        const name = player?.name || 'Unknown Player';
        const country = player?.country || 'ğŸŒ';
        
        document.getElementById('player-avatar').src = avatar;
        document.getElementById('player-name').textContent = name;
        document.getElementById('player-country').innerHTML = getCountryImage(country);
        
        // Rank (ì•ˆì „í•œ ì ‘ê·¼)
        const getMedalImage = (medal, subrank) => {
            const medalRankMap = {
                'Eternus': 11, 'Phantom': 10, 'Oracle': 9, 'Ritualist': 8,
                'Alchemist': 7, 'Arcanist': 6, 'Initiate': 5
            };
            const rankNumber = medalRankMap[medal] || 9;
            return `https://cdn.deadlock.coach/vpk/panorama/images/ranked/badges/rank${rankNumber}/badge_sm_subrank${subrank || 1}.webp`;
        };
        
        // ì˜ì–´ ë“±ê¸‰ì„ í•œê¸€ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
        const getKoreanMedal = (englishMedal) => {
            const medalTranslation = {
                'Eternus': 'ì´í„°ëˆ„ìŠ¤',
                'Phantom': 'íŒ¬í…€',
                'Oracle': 'ì˜¤ë¼í´',
                'Ritualist': 'ë¦¬ì¸„ì–¼ë¦¬ìŠ¤íŠ¸',
                'Alchemist': 'ì•Œì¼€ë¯¸ìŠ¤íŠ¸',
                'Arcanist': 'ì•„ì¼€ë‹ˆìŠ¤íŠ¸',
                'Initiate': 'íƒí—˜ê°€'
            };
            return medalTranslation[englishMedal] || englishMedal;
        };
        
        const medal = player?.rank?.medal || 'Oracle';
        const subrank = player?.rank?.subrank || 1;
        const score = player?.rank?.score || 3500;
        
        document.getElementById('rank-medal').src = getMedalImage(medal, subrank);
        document.getElementById('rank-name').textContent = `${getKoreanMedal(medal)} ${subrank}`;
        document.getElementById('rank-score').textContent = (typeof score === 'number' ? score : parseInt(score) || 3500).toLocaleString();
        
        // Stats (ì•ˆì „í•œ ì ‘ê·¼)
        const stats = player?.stats || {};
        const matches = stats.matches || 0;
        const winRate = stats.winRate || 0;
        const laneWinRate = stats.laneWinRate || 0;
        const kda = stats.kda || '0.0';
        const soulsPerMin = stats.soulsPerMin || 0;
        const denies = stats.denies || 0;
        const endorsements = stats.endorsements || 0;
        
        document.getElementById('stat-matches').textContent = matches;
        document.getElementById('stat-winrate').textContent = `${winRate}%`;
        document.getElementById('stat-lane-winrate').textContent = `${laneWinRate}%`;
        document.getElementById('stat-kda').textContent = kda;
        document.getElementById('stat-souls').textContent = (typeof soulsPerMin === 'number' ? soulsPerMin : parseInt(soulsPerMin) || 0).toLocaleString();
        document.getElementById('stat-denies').textContent = (typeof denies === 'number' ? denies : parseInt(denies) || 0).toLocaleString();
        document.getElementById('stat-endorsements').textContent = (typeof endorsements === 'number' ? endorsements : parseInt(endorsements) || 0).toLocaleString();
        
        // í‰ê·  ë§¤ì¹˜ ì‹œê°„ ì—…ë°ì´íŠ¸ (avgMatchDurationì´ ìˆë‹¤ë©´)
        if (window.playerData && window.playerData.stats && window.playerData.stats.avgMatchDuration) {
            document.getElementById('stat-duration').textContent = window.playerData.stats.avgMatchDuration;
        }
        
        console.log('âœ… ê¸°ë³¸ UI ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        
        // ì¦‰ì‹œ ì˜ì›… ë° ë§¤ì¹˜ ë°ì´í„° í‘œì‹œ
        if (heroStats && Array.isArray(heroStats) && heroStats.length > 0) {
            console.log('ğŸ¯ ì˜ì›… ìŠ¤íƒ¯ í‘œì‹œ:', heroStats.length, 'ê°œ');
            displayHeroStats(heroStats);
        } else {
            console.log('âš ï¸ ì˜ì›… ìŠ¤íƒ¯ ì—†ìŒ');
            document.getElementById('heroes-grid').innerHTML = '<p style="color: #999; text-align: center;">ì˜ì›… ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        }
        
        if (matchHistory && Array.isArray(matchHistory) && matchHistory.length > 0) {
            console.log('ğŸ“‹ ë§¤ì¹˜ íˆìŠ¤í† ë¦¬ í‘œì‹œ:', matchHistory.length, 'ê°œ');
            displayMatchHistory(matchHistory);
        } else {
            console.log('âš ï¸ ë§¤ì¹˜ íˆìŠ¤í† ë¦¬ ì—†ìŒ');
            document.getElementById('matches-list').innerHTML = '<p style="color: #999; text-align: center;">ìµœê·¼ ë§¤ì¹˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        }
        
        if (partyStats && Array.isArray(partyStats) && partyStats.length > 0) {
            console.log('ğŸ‘¥ íŒŒí‹° ìŠ¤íƒ¯ í‘œì‹œ:', partyStats.length, 'ê°œ');
            displayPartyStats(partyStats);
        } else {
            console.log('âš ï¸ íŒŒí‹° ìŠ¤íƒ¯ ì—†ìŒ');
            document.getElementById('party-stats-list').innerHTML = '<p style="color: #999; text-align: center;">íŒŒí‹° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        }
        
        console.log('ğŸ‰ ëª¨ë“  UI ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        
    } catch (error) {
        console.error('âŒ UI ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);
        throw error;
    }
}

// ê¸°ì¡´ í•¨ìˆ˜ëŠ” í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€
function updatePlayerUI(player) {
    // ê¸°ë³¸ ì •ë³´ë§Œ ì—…ë°ì´íŠ¸í•˜ê³  ë³„ë„ë¡œ ë¡œë“œ
    document.getElementById('player-avatar').src = player.avatar;
    document.getElementById('player-name').textContent = player.name;
    document.getElementById('player-country').textContent = player.country;
    
    const getMedalImage = (medal, subrank) => {
        const medalRankMap = {
            'Eternus': 11, 'Phantom': 10, 'Oracle': 9, 'Ritualist': 8,
            'Alchemist': 7, 'Arcanist': 6, 'Initiate': 5
        };
        const rankNumber = medalRankMap[medal] || 9;
        return `https://cdn.deadlock.coach/vpk/panorama/images/ranked/badges/rank${rankNumber}/badge_sm_subrank${subrank}.webp`;
    };
    
    // ì˜ì–´ ë“±ê¸‰ì„ í•œê¸€ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
    const getKoreanMedal = (englishMedal) => {
        const medalTranslation = {
            'Eternus': 'ì´í„°ëˆ„ìŠ¤',
            'Phantom': 'íŒ¬í…€',
            'Oracle': 'ì˜¤ë¼í´',
            'Ritualist': 'ë¦¬ì¸„ì–¼ë¦¬ìŠ¤íŠ¸',
            'Alchemist': 'ì•Œì¼€ë¯¸ìŠ¤íŠ¸',
            'Arcanist': 'ì•„ì¼€ë‹ˆìŠ¤íŠ¸',
            'Initiate': 'íƒí—˜ê°€'
        };
        return medalTranslation[englishMedal] || englishMedal;
    };
    
    document.getElementById('rank-medal').src = getMedalImage(player.rank.medal, player.rank.subrank);
    document.getElementById('rank-name').textContent = `${getKoreanMedal(player.rank.medal)} ${player.rank.subrank}`;
    document.getElementById('rank-score').textContent = player.rank.score.toLocaleString();
    
    document.getElementById('stat-matches').textContent = player.stats.matches;
    document.getElementById('stat-winrate').textContent = `${player.stats.winRate}%`;
    document.getElementById('stat-lane-winrate').textContent = `${player.stats.laneWinRate}%`;
    document.getElementById('stat-kda').textContent = player.stats.kda;
    document.getElementById('stat-headshots').textContent = `${player.stats.headshotPercent}%`;
    document.getElementById('stat-souls').textContent = player.stats.soulsPerMin.toLocaleString();
    document.getElementById('stat-damage').textContent = player.stats.damagePerMin.toLocaleString();
    document.getElementById('stat-healing').textContent = player.stats.healingPerMin.toLocaleString();
    
    // í‰ê·  ë§¤ì¹˜ ì‹œê°„ ì—…ë°ì´íŠ¸ (deadlock.coach ìŠ¤íƒ€ì¼)
    if (player.stats.avgMatchDuration) {
        document.getElementById('stat-duration').textContent = player.stats.avgMatchDuration;
    }
    
    loadHeroStats(player.accountId);
    loadMatchHistory(player.accountId);
}

// ì˜ì›…ë³„ ìŠ¤íƒ¯ ë¡œë“œ
async function loadHeroStats(accountId) {
    const grid = document.getElementById('heroes-grid');
    
    try {
        const response = await fetch(`/api/v1/players/${accountId}/hero-stats`);
        const heroStats = await response.json();
        
        if (response.ok && heroStats.length > 0) {
            displayHeroStats(heroStats);
        } else {
            throw new Error('ì˜ì›… ìŠ¤íƒ¯ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        }
    } catch (error) {
        console.error('ì˜ì›… ìŠ¤íƒ¯ ë¡œë“œ ì‹¤íŒ¨:', error);
        grid.innerHTML = '<p style="color: #999; text-align: center;">ì˜ì›… ìŠ¤íƒ¯ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
    }
}

// ì˜ì›… ìŠ¤íƒ¯ í‘œì‹œ
function displayHeroStats(heroStats) {
    const grid = document.getElementById('heroes-grid');
    
    try {
        console.log('ğŸ¯ ì˜ì›… ìŠ¤íƒ¯ í‘œì‹œ ì‹œì‘:', heroStats);
        
        if (!Array.isArray(heroStats) || heroStats.length === 0) {
            grid.innerHTML = '<p style="color: #999; text-align: center;">ì˜ì›… ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }
        
        const getHeroImage = (heroName) => {
            const heroImageMap = {
                'Abrams': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/bull_card.webp',
                'Bebop': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/bebop_card.webp',
                'Calico': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/nano_card.webp',
                'Dynamo': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/sumo_card.webp',
                'Grey Talon': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/archer_card.webp',
                'Haze': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/haze_card.webp',
                'Infernus': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/inferno_card.webp',
                'Ivy': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/tengu_card.webp',
                'Kelvin': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/kelvin_card.webp',
                'Lady Geist': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/spectre_card.webp',
                'Lash': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/lash_card.webp',
                'McGinnis': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/engineer_card.webp',
                'Mo & Krill': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/digger_card.webp',
                'Paradox': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/chrono_card.webp',
                'Pocket': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/synth_card.webp',
                'Seven': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/gigawatt_card.webp',
                'Shiv': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/shiv_card.webp',
                'Viper': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/kali_card.webp',
                'Viscous': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/viscous_card.webp',
                'Warden': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/warden_card.webp',
                'Vyper': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/kali_card.webp',
                'Holliday': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/astro_card.webp',
                'Mirage': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/mirage_card.webp',
                'Wraith': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/wraith_card.webp',
                'Yamato': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/yamato_card.webp',
                'Sinclair': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/magician_card.webp'
            };
            return heroImageMap[heroName] || 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/bull_card.webp';
        };
        
        const heroCards = heroStats.map((hero, index) => {
            try {
                // ìƒˆë¡œìš´ hero-stats API ë°ì´í„° êµ¬ì¡° ì‚¬ìš©
                const matches = parseInt(hero?.matches) || 0;
                const wins = parseInt(hero?.wins) || 0;
                const losses = parseInt(hero?.losses) || (matches - wins);
                const winRate = hero?.winRate || (matches > 0 ? Math.round((wins / matches) * 100) : 0);
                const kda = hero?.kda || '0.0';
                const avgKills = hero?.avgKills || 0;
                const avgDeaths = hero?.avgDeaths || 0;
                const avgAssists = hero?.avgAssists || 0;
                const avgSoulsPerMin = hero?.avgSoulsPerMin || 0;
                const avgDamagePerMin = hero?.avgDamagePerMin || 0;
                const avgHealingPerMin = hero?.avgHealingPerMin || 0;
                const avgMatchDuration = hero?.avgMatchDuration || 0;
                const durationFormatted = hero?.avgMatchDurationFormatted || 
                    (avgMatchDuration > 0 ? `${Math.floor(avgMatchDuration / 60)}:${(avgMatchDuration % 60).toString().padStart(2, '0')}` : '0:00');
                const heroName = hero?.hero || hero?.name || `Hero${index + 1}`;
                const accuracy = hero?.accuracy || 0;
                const critShotRate = hero?.critShotRate || 0;
                const avgLevel = hero?.avgLevel || 0;
                const timePlayedHours = hero?.timePlayedTotal ? (hero.timePlayedTotal / 3600).toFixed(1) : 0;
                
                return `
                    <div class="hero-card detailed">
                        <img src="${getHeroImage(heroName)}" alt="${heroName}" class="hero-card-image">
                        <div class="hero-card-info">
                            <h3 class="hero-card-name">${heroName}</h3>
                            <div class="hero-card-main-stats">
                                <div class="hero-stat-row">
                                    <span class="hero-stat-label">ë§¤ì¹˜:</span>
                                    <span class="hero-stat-value">${matches} (${wins}ìŠ¹ ${losses}íŒ¨)</span>
                                </div>
                                <div class="hero-stat-row">
                                    <span class="hero-stat-label">ìŠ¹ë¥ :</span>
                                    <span class="hero-stat-value ${winRate >= 50 ? 'positive' : 'negative'}">${winRate}%</span>
                                </div>
                                <div class="hero-stat-row">
                                    <span class="hero-stat-label">ì´ í”Œë ˆì´ ì‹œê°„:</span>
                                    <span class="hero-stat-value">${timePlayedHours}ì‹œê°„</span>
                                </div>
                            </div>
                            <div class="hero-card-detailed-stats">
                                <div class="hero-stat-row">
                                    <span class="hero-stat-label">KDA:</span>
                                    <span class="hero-stat-value">${avgKills}/${avgDeaths}/${avgAssists} (${kda})</span>
                                </div>
                                <div class="hero-stat-row">
                                    <span class="hero-stat-label">í‰ê·  ë ˆë²¨:</span>
                                    <span class="hero-stat-value">${avgLevel}</span>
                                </div>
                                <div class="hero-stat-row">
                                    <span class="hero-stat-label">ëª…ì¤‘ë¥ :</span>
                                    <span class="hero-stat-value">${accuracy}%</span>
                                </div>
                                <div class="hero-stat-row">
                                    <span class="hero-stat-label">í¬ë¦¬í‹°ì»¬ìœ¨:</span>
                                    <span class="hero-stat-value">${critShotRate}%</span>
                                </div>
                                <div class="hero-stat-row">
                                    <span class="hero-stat-label">ì†Œìš¸/ë¶„:</span>
                                    <span class="hero-stat-value">${avgSoulsPerMin.toLocaleString()}</span>
                                </div>
                                <div class="hero-stat-row">
                                    <span class="hero-stat-label">ë°ë¯¸ì§€/ë¶„:</span>
                                    <span class="hero-stat-value">${avgDamagePerMin.toLocaleString()}</span>
                                </div>
                                <div class="hero-stat-row">
                                    <span class="hero-stat-label">í‰ê·  ì‹œê°„:</span>
                                    <span class="hero-stat-value">${durationFormatted}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } catch (heroError) {
                console.error('ì˜ì›… ì¹´ë“œ ìƒì„± ì˜¤ë¥˜:', heroError, hero);
                return `
                    <div class="hero-card">
                        <img src="https://cdn.deadlock.coach/vpk/panorama/images/heroes/bull_card.webp" alt="Unknown" class="hero-card-image">
                        <div class="hero-card-info">
                            <h3>Unknown Hero</h3>
                            <div class="hero-card-stats">ë°ì´í„° ì˜¤ë¥˜</div>
                        </div>
                    </div>
                `;
            }
        });
        
        grid.innerHTML = heroCards.join('');
        console.log('âœ… ì˜ì›… ìŠ¤íƒ¯ í‘œì‹œ ì™„ë£Œ');
        
    } catch (error) {
        console.error('âŒ ì˜ì›… ìŠ¤íƒ¯ í‘œì‹œ ì˜¤ë¥˜:', error);
        grid.innerHTML = '<p style="color: #ff6b6b; text-align: center;">ì˜ì›… ë°ì´í„° í‘œì‹œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
    }
}

// ë§¤ì¹˜ íˆìŠ¤í† ë¦¬ ë¡œë“œ
async function loadMatchHistory(accountId) {
    const matchesList = document.getElementById('matches-list');
    
    try {
        const response = await fetch(`/api/v1/players/${accountId}/match-history?limit=20`);
        const matches = await response.json();
        
        if (response.ok && matches.length > 0) {
            displayMatchHistory(matches);
        } else {
            throw new Error('ë§¤ì¹˜ íˆìŠ¤í† ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        }
    } catch (error) {
        console.error('ë§¤ì¹˜ íˆìŠ¤í† ë¦¬ ë¡œë“œ ì‹¤íŒ¨:', error);
        matchesList.innerHTML = '<p style="color: #999; text-align: center;">ë§¤ì¹˜ íˆìŠ¤í† ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
    }
}

// ë§¤ì¹˜ íˆìŠ¤í† ë¦¬ í‘œì‹œ
function displayMatchHistory(matches) {
    const matchesList = document.getElementById('matches-list');
    
    try {
        console.log('ğŸ“‹ ë§¤ì¹˜ íˆìŠ¤í† ë¦¬ í‘œì‹œ ì‹œì‘:', matches);
        
        if (!Array.isArray(matches) || matches.length === 0) {
            matchesList.innerHTML = '<p style="color: #999; text-align: center;">ìµœê·¼ ë§¤ì¹˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }
        
        const getHeroImage = (heroName) => {
            const heroImageMap = {
                'Abrams': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/bull_card.webp',
                'Bebop': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/bebop_card.webp',
                'Calico': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/nano_card.webp',
                'Dynamo': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/sumo_card.webp',
                'Grey Talon': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/archer_card.webp',
                'Haze': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/haze_card.webp',
                'Infernus': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/inferno_card.webp',
                'Ivy': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/tengu_card.webp',
                'Kelvin': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/kelvin_card.webp',
                'Lady Geist': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/spectre_card.webp',
                'Lash': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/lash_card.webp',
                'McGinnis': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/engineer_card.webp',
                'Mo & Krill': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/digger_card.webp',
                'Paradox': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/chrono_card.webp',
                'Pocket': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/synth_card.webp',
                'Seven': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/gigawatt_card.webp',
                'Shiv': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/shiv_card.webp',
                'Viper': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/kali_card.webp',
                'Viscous': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/viscous_card.webp',
                'Warden': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/warden_card.webp',
                'Vyper': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/kali_card.webp',
                'Holliday': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/astro_card.webp',
                'Mirage': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/mirage_card.webp',
                'Wraith': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/wraith_card.webp',
                'Yamato': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/yamato_card.webp',
                'Sinclair': 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/magician_card.webp'
            };
            return heroImageMap[heroName] || 'https://cdn.deadlock.coach/vpk/panorama/images/heroes/bull_card.webp';
        };
        
        const formatDate = (dateString) => {
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return 'ì•Œ ìˆ˜ ì—†ìŒ';
                
                const now = new Date();
                const diffHours = Math.floor((now - date) / (1000 * 60 * 60));
                
                if (diffHours < 1) return 'ë°©ê¸ˆ ì „';
                if (diffHours < 24) return `${diffHours}ì‹œê°„ ì „`;
                const diffDays = Math.floor(diffHours / 24);
                if (diffDays < 7) return `${diffDays}ì¼ ì „`;
                return date.toLocaleDateString('ko-KR');
            } catch (error) {
                return 'ì•Œ ìˆ˜ ì—†ìŒ';
            }
        };
        
        const matchCards = matches.map((match, index) => {
            try {
                // ì•ˆì „í•œ ë°ì´í„° ì¶”ì¶œ
                const hero = match?.hero || 'Unknown';
                const result = match?.result || 'ì•Œ ìˆ˜ ì—†ìŒ';
                const isWin = result === 'ìŠ¹ë¦¬';
                const matchResult = match?.matchResult || (isWin ? 'Match won' : 'Match lost');
                const laneResult = match?.laneResult || 'Lane unknown';
                const duration = match?.durationFormatted || match?.duration ? `${Math.floor(match.duration / 60)}:${(match.duration % 60).toString().padStart(2, '0')}` : '0:00';
                const kills = parseInt(match?.kills) || 0;
                const deaths = parseInt(match?.deaths) || 0;
                const assists = parseInt(match?.assists) || 0;
                const kda = match?.kda || '0.0';
                const souls = parseInt(match?.souls) || 0;
                const damage = parseInt(match?.damage) || 0;
                const playedAt = match?.playedAt || new Date().toISOString();
                const matchId = match?.matchId || 'Unknown';
                const teamRank = parseInt(match?.teamRank) || 6;
                
                return `
                    <div class="match-card ${isWin ? 'win' : 'loss'}">
                        <div class="match-hero">
                            <img src="${getHeroImage(hero)}" alt="${hero}" class="match-hero-image">
                            <span class="match-hero-name">${hero}</span>
                        </div>
                        <div class="match-result">
                            <div class="match-outcomes">
                                <span class="match-outcome ${isWin ? 'win-text' : 'loss-text'}">${matchResult}</span>
                                <span class="lane-outcome ${laneResult.includes('won') ? 'win-text' : laneResult.includes('lost') ? 'loss-text' : 'unknown-text'}">${laneResult}</span>
                            </div>
                            <div class="match-meta-info">
                                <span class="match-duration">${duration}</span>
                                <div class="team-rank-badge">
                                    <img src="https://cdn.deadlock.coach/vpk/panorama/images/ranked/badges/rank${teamRank > 3 ? Math.max(1, 7-teamRank) : teamRank}/badge_sm_subrank${teamRank}.webp" 
                                         alt="Team Rank ${teamRank}" 
                                         class="rank-badge-image"
                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                                    <span class="rank-fallback" style="display: none;">${teamRank}</span>
                                </div>
                            </div>
                            <span class="match-id">ë§¤ì¹˜ #${matchId}</span>
                        </div>
                        <div class="match-stats">
                            <span class="kda">${kills}/${deaths}/${assists}</span>
                            <span class="kda-ratio">KDA: ${kda}</span>
                        </div>
                        <div class="match-performance">
                            <div class="performance-item">
                                <span class="performance-label">ì†Œìš¸</span>
                                <span class="performance-value">${souls.toLocaleString()}</span>
                            </div>
                            <div class="performance-item">
                                <span class="performance-label">ë°ë¯¸ì§€</span>
                                <span class="performance-value">${damage.toLocaleString()}</span>
                            </div>
                        </div>
                        <div class="match-time">
                            ${formatDate(playedAt)}
                        </div>
                    </div>
                `;
            } catch (matchError) {
                console.error('ë§¤ì¹˜ ì¹´ë“œ ìƒì„± ì˜¤ë¥˜:', matchError, match);
                return `
                    <div class="match-card">
                        <div class="match-hero">
                            <img src="https://cdn.deadlock.coach/vpk/panorama/images/heroes/bull_card.webp" alt="Unknown" class="match-hero-image">
                            <span class="match-hero-name">Unknown</span>
                        </div>
                        <div class="match-result">
                            <span class="result-text">ë°ì´í„° ì˜¤ë¥˜</span>
                        </div>
                    </div>
                `;
            }
        });
        
        matchesList.innerHTML = matchCards.join('');
        console.log('âœ… ë§¤ì¹˜ íˆìŠ¤í† ë¦¬ í‘œì‹œ ì™„ë£Œ');
        
    } catch (error) {
        console.error('âŒ ë§¤ì¹˜ íˆìŠ¤í† ë¦¬ í‘œì‹œ ì˜¤ë¥˜:', error);
        matchesList.innerHTML = '<p style="color: #ff6b6b; text-align: center;">ë§¤ì¹˜ ë°ì´í„° í‘œì‹œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
    }
}

// íŒŒí‹° ìŠ¤íƒ¯ í‘œì‹œ
function displayPartyStats(partyStats) {
    const partyStatsList = document.getElementById('party-stats-list');
    
    try {
        console.log('ğŸ‘¥ íŒŒí‹° ìŠ¤íƒ¯ í‘œì‹œ ì‹œì‘:', partyStats);
        
        if (!Array.isArray(partyStats) || partyStats.length === 0) {
            partyStatsList.innerHTML = '<p style="color: #999; text-align: center;">íŒŒí‹° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }
        
        const formatDate = (dateString) => {
            try {
                if (!dateString) return 'ì•Œ ìˆ˜ ì—†ìŒ';
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return 'ì•Œ ìˆ˜ ì—†ìŒ';
                
                const now = new Date();
                const diffHours = Math.floor((now - date) / (1000 * 60 * 60));
                
                if (diffHours < 1) return 'ë°©ê¸ˆ ì „';
                if (diffHours < 24) return `${diffHours}ì‹œê°„ ì „`;
                const diffDays = Math.floor(diffHours / 24);
                if (diffDays < 7) return `${diffDays}ì¼ ì „`;
                return date.toLocaleDateString('ko-KR');
            } catch (error) {
                return 'ì•Œ ìˆ˜ ì—†ìŒ';
            }
        };
        
        const partyCards = partyStats.map((member, index) => {
            try {
                // deadlock.coach ìŠ¤íƒ€ì¼ ë°ì´í„° ê²€ì¦
                if (!member || !member.accountId || member.accountId === 'undefined' || member.accountId === null) {
                    console.log('âš ï¸ ìœ íš¨í•˜ì§€ ì•Šì€ íŒŒí‹° ë©¤ë²„ ë°ì´í„°:', member);
                    return ''; // ìœ íš¨í•˜ì§€ ì•Šì€ ë°ì´í„°ëŠ” í‘œì‹œí•˜ì§€ ì•ŠìŒ
                }
                
                const accountId = member.accountId;
                const name = member.name && member.name !== 'undefined' ? member.name : `Player_${accountId}`;
                const matches = parseInt(member.matches) || 0;
                const wins = parseInt(member.wins) || 0;
                const losses = parseInt(member.losses) || 0;
                const winRate = parseInt(member.winRate) || 0;
                const avgKda = member.avgKda || '0.0';
                const lastPlayed = member.lastPlayedTogether || null;
                
                return `
                    <div class="party-member" data-account-id="${accountId}">
                        <div class="party-member-avatar">
                            <img src="${member?.avatar || 'https://avatars.cloudflare.steamstatic.com/fef49e7fa7e1997310d705b2a6158ff8dc1cdfeb_full.jpg'}" 
                                 alt="${name}" 
                                 onerror="this.src='https://avatars.cloudflare.steamstatic.com/fef49e7fa7e1997310d705b2a6158ff8dc1cdfeb_full.jpg'">
                        </div>
                        <div class="party-member-info">
                            <div class="party-member-name">${name}</div>
                            <div class="party-member-matches">${matches} ë§¤ì¹˜</div>
                        </div>
                        <div class="party-member-winrate">
                            <div class="winrate-value">${winRate}%</div>
                            <div class="winrate-label">ìŠ¹ë¥ </div>
                        </div>
                    </div>
                `;
            } catch (memberError) {
                console.error('íŒŒí‹° ë©¤ë²„ ì¹´ë“œ ìƒì„± ì˜¤ë¥˜:', memberError, member);
                return `
                    <div class="party-member">
                        <div class="party-member-info">
                            <div class="party-member-name">Unknown Player</div>
                            <div class="party-member-id">ë°ì´í„° ì˜¤ë¥˜</div>
                        </div>
                    </div>
                `;
            }
        });
        
        // deadlock.coach ìŠ¤íƒ€ì¼: ë¹ˆ ì¹´ë“œëŠ” í•„í„°ë§í•˜ê³  í‘œì‹œ
        const validPartyCards = partyCards.filter(card => card.trim() !== '');
        partyStatsList.innerHTML = validPartyCards.join('');
        
        // íŒŒí‹°ì› í´ë¦­ ì‹œ í”„ë¡œí•„ ì´ë™ ê¸°ëŠ¥ ì¶”ê°€
        partyStatsList.addEventListener('click', (e) => {
            const partyMember = e.target.closest('.party-member');
            if (partyMember) {
                const accountId = partyMember.dataset.accountId;
                console.log('íŒŒí‹° ë©¤ë²„ í´ë¦­:', { accountId: accountId });
                if (accountId && accountId !== 'Unknown') {
                    console.log('í”„ë¡œí•„ í˜ì´ì§€ë¡œ ì´ë™:', `/ko/players/${accountId}`);
                    window.location.href = `/ko/players/${accountId}`;
                } else {
                    console.log('ìœ íš¨í•˜ì§€ ì•Šì€ Account ID:', accountId);
                    alert('ì´ í”Œë ˆì´ì–´ì˜ í”„ë¡œí•„ì„ ë³¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            }
        });
        
        console.log('âœ… íŒŒí‹° ìŠ¤íƒ¯ í‘œì‹œ ì™„ë£Œ');
        
    } catch (error) {
        console.error('âŒ íŒŒí‹° ìŠ¤íƒ¯ í‘œì‹œ ì˜¤ë¥˜:', error);
        partyStatsList.innerHTML = '<p style="color: #ff6b6b; text-align: center;">íŒŒí‹° ë°ì´í„° í‘œì‹œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
    }
}


// Load data when page loads
document.addEventListener('DOMContentLoaded', loadMyProfileData);
</script>