<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deadlock í†µê³„ - ê°œì„ ëœ ë²„ì „</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.8;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .card-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
            color: #ffd700;
        }

        .ranking-list {
            list-style: none;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ranking-item:last-child {
            border-bottom: none;
        }

        .rank-number {
            font-size: 1.2em;
            font-weight: bold;
            color: #ffd700;
            min-width: 30px;
        }

        .item-info {
            display: flex;
            align-items: center;
            flex: 1;
            margin-left: 15px;
        }

        .item-image {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            margin-right: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .item-image.error {
            background: linear-gradient(45deg, #ffd700, #ff8c00);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            font-weight: bold;
        }

        .hero-image {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .hero-image.error {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .character-name, .item-name {
            font-size: 1.1em;
        }

        .stat-value {
            font-weight: bold;
            color: #4CAF50;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            opacity: 0.7;
            animation: pulse 2s infinite;
        }

        .last-update {
            text-align: center;
            margin-top: 15px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            font-size: 0.9em;
            opacity: 0.8;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .error-message {
            text-align: center;
            padding: 20px;
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        .retry-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            margin-top: 10px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .retry-button:hover {
            background: #45a049;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ ì¶”ê°€ */
        .nav-links {
            text-align: center;
            margin-bottom: 20px;
        }

        .nav-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            margin: 0 15px;
            padding: 8px 16px;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .nav-links a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .nav-links a.active {
            background: rgba(255, 255, 255, 0.2);
            color: #ffd700;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-links">
            <a href="/">í™ˆ</a>
            <a href="/heroes">ì˜ì›…</a>
            <a href="/items">ì•„ì´í…œ</a>
            <a href="/stats" class="active">í†µê³„</a>
        </div>

        <header>
            <h1>ğŸ® Deadlock í†µê³„</h1>
            <p class="subtitle">ìºë¦­í„° & ì•„ì´í…œ ë­í‚¹ (ìµœê·¼ 7ì¼)</p>
            <div id="last-update" class="last-update">
                <span>ğŸ“… ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ë¡œë”© ì¤‘...</span>
            </div>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <h2 class="card-title">ğŸ† ìµœê³  í”Œë ˆì´ ìºë¦­í„°</h2>
                <div id="most-played-section">
                    <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>

            <div class="stat-card">
                <h2 class="card-title">ğŸ¥‡ ìµœê³  ìŠ¹ë¥  ìºë¦­í„°</h2>
                <div id="win-rate-section">
                    <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>

            <div class="stat-card">
                <h2 class="card-title">âš”ï¸ ìµœë‹¤ ì‚¬ìš© ì•„ì´í…œ</h2>
                <div id="items-section">
                    <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('=== Deadlock í†µê³„ ê°œì„ ëœ ë²„ì „ ===');
        
        // ìºë¦­í„° IDë³„ í•œê¸€ ì´ë¦„ ë§¤í•‘ (ì •í™•í•œ ë§¤í•‘)
        const heroNames = {
            1: 'ì¸í˜ë¥´ëˆ„ìŠ¤',     // Infernus
            2: 'ì„¸ë¸',          // Seven
            3: 'ë¹ˆë”•íƒ€',        // Vindicta
            4: 'ë ˆì´ë”” ê°€ì´ìŠ¤íŠ¸', // Lady Geist
            6: 'ì•„ë¸ŒëŒìŠ¤',       // Abrams
            7: 'ë ˆì´ìŠ¤',        // Wraith
            8: 'ë§¥ê¸°ë‹ˆìŠ¤',       // McGinnis
            10: 'íŒ¨ëŸ¬ë…ìŠ¤',      // Paradox
            11: 'ë‹¤ì´ë‚˜ëª¨',      // Dynamo
            12: 'ì¼ˆë¹ˆ',         // Kelvin
            13: 'í—¤ì´ì¦ˆ',       // Haze
            14: 'í™€ë¦¬ë°ì´',      // Holliday
            15: 'ë¹„ë°¥',         // Bebop
            16: 'ì¹¼ë¦¬ì½”',       // Calico
            17: 'ê·¸ë ˆì´ íƒˆë¡ ',   // Grey Talon
            18: 'ëª¨ & í¬ë¦´',    // Mo & Krill
            19: 'ì‹œë¸Œ',         // Shiv
            20: 'ì•„ì´ë¹„',       // Ivy
            21: 'ì¹¼ë¦¬',         // Kali
            25: 'ì›Œë“ ',         // Warden
            27: 'ì•¼ë§ˆí† ',       // Yamato
            31: 'ë˜ì‹œ',         // Lash
            35: 'ë¹„ìŠ¤ì»¤ìŠ¤',      // Viscous
            38: 'ê±´ìŠ¬ë§ê±°',      // Gunslinger
            39: 'ë³´ìŠ¤',         // The Boss
            47: 'í† ì¹´ë§‰',       // Tokamak
            48: 'ë ˆì»¤',         // Wrecker
            49: 'ë£¨íŠ¸ê±°',       // Rutger
            50: 'í¬ì¼“',         // Pocket
            51: 'ì¸í¼',         // Thumper
            52: 'ë¯¸ë¼ì§€',       // Mirage
            53: 'íŒ¨ë¤',         // Fathom
            54: 'ì¹´ë´ìŠ¤',       // Cadence
            56: 'ë³´ë¨¸',         // Bomber
            57: 'ì‹¤ë“œ ê°€ì´',     // Shield Guy
            58: 'ë°”ì´í¼',       // Vyper
            59: 'ë°´ë‹¬',         // Vandal
            60: 'ì‹±í´ë ˆì–´',      // Sinclair
            61: 'íŠ¸ë˜í¼',       // Trapper
            62: 'ë ˆì´ë¸',       // Raven
            63: 'ë±€íŒŒì´ì–´ë°•ì¥',   // VampireBat
            64: 'ë“œë¦¬í”„í„°',      // Drifter
            65: 'í”„ë¦¬ìŠ¤íŠ¸',      // Priest
            66: 'í”„ë­í¬',       // Frank
            67: 'ë¶ì›œ',         // Bookworm
            68: 'ë³´í˜¸',         // Boho
            69: 'ë„ì–´ë§¨',       // Doorman
            70: 'ìŠ¤ì¹´ì´ëŸ¬ë„ˆ',     // Skyrunner
            71: 'ìŠ¤ì™„',         // Swan
            72: 'í‘í¬ê³ íŠ¸'       // Punkgoat
        };
        
        // ì£¼ìš” ì•„ì´í…œ IDë³„ í•œê¸€ ì´ë¦„ (ì§ì ‘ ë§¤í•‘)
        const itemNames = {};
        const itemImages = {};
        const heroImages = {};
        
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ìºì‹œ
        const CACHE_KEYS = {
            HERO_STATS: 'deadlock_hero_stats',
            ITEM_STATS: 'deadlock_item_stats',
            HERO_IMAGES: 'deadlock_hero_images',
            ITEM_MAPPINGS: 'deadlock_item_mappings',
            LAST_UPDATE: 'deadlock_last_update'
        };
        
        const CACHE_DURATION = 30 * 60 * 1000; // 30ë¶„
        
        // ìºì‹œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getCachedData(key) {
            try {
                const cached = localStorage.getItem(key);
                if (!cached) return null;
                
                const data = JSON.parse(cached);
                const now = Date.now();
                
                if (now - data.timestamp > CACHE_DURATION) {
                    localStorage.removeItem(key);
                    return null;
                }
                
                return data.value;
            } catch (error) {
                console.error('ìºì‹œ ì½ê¸° ì‹¤íŒ¨:', error);
                return null;
            }
        }
        
        // ìºì‹œì— ë°ì´í„° ì €ì¥
        function setCachedData(key, value) {
            try {
                const data = {
                    value: value,
                    timestamp: Date.now()
                };
                localStorage.setItem(key, JSON.stringify(data));
            } catch (error) {
                console.error('ìºì‹œ ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }
        
        // ë¡œë”© ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateLoadingStatus(section, message) {
            const element = document.getElementById(section);
            if (element) {
                element.innerHTML = `<div class="loading">${message}</div>`;
            }
        }

        // ì—ëŸ¬ ìƒíƒœ í‘œì‹œ í•¨ìˆ˜
        function showError(section, message) {
            const element = document.getElementById(section);
            if (element) {
                element.innerHTML = `<div class="error-message">âŒ ${message}</div>`;
            }
        }

        // íƒ€ì„ì•„ì›ƒì´ ìˆëŠ” fetch í•¨ìˆ˜
        async function fetchWithTimeout(url, timeout = 10000) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);
            
            try {
                const response = await fetch(url, {
                    signal: controller.signal,
                    headers: {
                        'Cache-Control': 'no-cache'
                    }
                });
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                return response;
            } catch (error) {
                clearTimeout(timeoutId);
                if (error.name === 'AbortError') {
                    throw new Error('ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤');
                }
                throw error;
            }
        }

        // ìºë¦­í„° ì´ë¯¸ì§€ ë°ì´í„° ë¡œë“œ
        async function loadHeroImages() {
            try {
                // ìºì‹œì—ì„œ ë¨¼ì € í™•ì¸
                const cachedImages = getCachedData(CACHE_KEYS.HERO_IMAGES);
                if (cachedImages) {
                    Object.assign(heroImages, cachedImages);
                    console.log('ìºë¦­í„° ì´ë¯¸ì§€ ìºì‹œ ë¡œë“œ ì™„ë£Œ:', Object.keys(heroImages).length, 'ê°œ');
                    return;
                }
                
                const response = await fetchWithTimeout('https://assets.deadlock-api.com/v2/heroes', 10000);
                const heroes = await response.json();
                
                heroes.forEach(hero => {
                    if (hero.images && hero.images.icon_image_small) {
                        heroImages[hero.id] = hero.images.icon_image_small;
                    }
                });
                
                // ìºì‹œì— ì €ì¥
                setCachedData(CACHE_KEYS.HERO_IMAGES, heroImages);
                
                console.log('ìºë¦­í„° ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ:', Object.keys(heroImages).length, 'ê°œ');
            } catch (error) {
                console.error('ìºë¦­í„° ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', error);
                // ìºì‹œì—ì„œ ì´ì „ ë°ì´í„° ì‚¬ìš© ì‹œë„
                const cachedImages = getCachedData(CACHE_KEYS.HERO_IMAGES);
                if (cachedImages) {
                    Object.assign(heroImages, cachedImages);
                    console.log('ìºë¦­í„° ì´ë¯¸ì§€ ìºì‹œ ì‚¬ìš© (ì´ì „ ë°ì´í„°)');
                }
            }
        }
        
        // ì•„ì´í…œ ë°ì´í„°ë¥¼ ë¨¼ì € ë¡œë“œí•˜ê³  ë§¤í•‘ ìƒì„±
        async function loadItemMappings() {
            try {
                // ìºì‹œì—ì„œ ë¨¼ì € í™•ì¸
                const cachedMappings = getCachedData(CACHE_KEYS.ITEM_MAPPINGS);
                if (cachedMappings) {
                    Object.assign(itemNames, cachedMappings.names);
                    Object.assign(itemImages, cachedMappings.images);
                    console.log('ì•„ì´í…œ ë§¤í•‘ ìºì‹œ ë¡œë“œ ì™„ë£Œ:', Object.keys(itemNames).length, 'ê°œ');
                    return true;
                }
                
                const response = await fetchWithTimeout('https://assets.deadlock-api.com/v2/items', 10000);
                const items = await response.json();
                
                // ì£¼ìš” ì•„ì´í…œë“¤ì— ëŒ€í•œ í•œê¸€ ë§¤í•‘
                const koreanNames = {
                    // ìƒìœ„ ì•„ì´í…œë“¤ (ìì£¼ ì‚¬ìš©ë˜ëŠ” ê²ƒë“¤)
                    'Superior Cooldown': 'ìƒê¸‰ ì¿¨ë‹¤ìš´ ê°ì†Œ',
                    'Extra Regen': 'ì¶”ê°€ ì¬ìƒ',
                    'Compress Cooldown': 'ì••ì¶• ì¿¨ë‹¤ìš´',
                    'Extra Spirit': 'ì¶”ê°€ ì •ì‹ ë ¥',
                    'Fortitude': 'ë¶ˆêµ´',
                    'Extra Stamina': 'ì¶”ê°€ ìŠ¤íƒœë¯¸ë‚˜',
                    'Extra Health': 'ì¶”ê°€ ì²´ë ¥',
                    'Improved Spirit': 'ê°œì„ ëœ ì •ì‹ ë ¥',
                    'Quicksilver Reload': 'ìˆ˜ì€ ì¬ì¥ì „',
                    'Mystic Burst': 'ì‹ ë¹„ ì ì‚¬',
                    'Enchanter\'s Emblem': 'ë§ˆë²•ì‚¬ ì— ë¸”ëŸ¼',
                    'Rapid Rounds': 'ë¹ ë¥¸ íƒ„í™˜',
                    'Extra Charge': 'ì¶”ê°€ ì¶©ì „',
                    'Extended Magazine': 'í™•ì¥ íƒ„ì°½',
                    'Titanic Magazine': 'íƒ€ì´íƒ€ë‹‰ íƒ„ì°½',
                    
                    // ê¸°íƒ€ ì£¼ìš” ì•„ì´í…œë“¤
                    'Improved Cooldown': 'ê°œì„ ëœ ì¿¨ë‹¤ìš´ ê°ì†Œ',
                    'Melee Charge': 'ê·¼ì ‘ ëŒê²©',
                    'Basic Magazine': 'ê¸°ë³¸ íƒ„ì°½',
                    'Bullet Armor': 'ì´ì•Œ ë°©ì–´êµ¬',
                    'Spirit Armor': 'ì •ì‹  ë°©ì–´êµ¬',
                    'Healing Rite': 'ì¹˜ìœ  ì˜ì‹',
                    'Sprint Boots': 'ì§ˆì£¼ ë¶€ì¸ ',
                    'Enduring Speed': 'ì§€ì† ì†ë„',
                    'Monster Rounds': 'ëª¬ìŠ¤í„° íƒ„í™˜',
                    'High-Velocity Mag': 'ê³ ì† íƒ„ì°½',
                    'Headshot Booster': 'í—¤ë“œìƒ· ë¶€ìŠ¤í„°',
                    'Kinetic Dash': 'ìš´ë™ ëŒì§„',
                    'Combat Barrier': 'ì „íˆ¬ ë°©ë²½',
                    'Debuff Reducer': 'ë””ë²„í”„ ê°ì†Œ',
                    'Divine Barrier': 'ì‹ ì„± ë°©ë²½',
                    'Healing Booster': 'ì¹˜ìœ  ë¶€ìŠ¤í„°',
                    'Mystic Vulnerability': 'ì‹ ë¹„ ì·¨ì•½ì ',
                    'Return Fire': 'ë°˜ê²© ì‚¬ê²©',
                    'Reactive Barrier': 'ë°˜ì‘í˜• ë°©ë²½',
                    'Restorative Shot': 'íšŒë³µ ì‚¬ê²©',
                    'Soul Shredder Bullets': 'ì˜í˜¼ íŒŒì‡„ íƒ„í™˜',
                    'Explosive Rounds': 'í­ë°œ íƒ„í™˜',
                    'Toxic Bullets': 'ë…ì„± íƒ„í™˜',
                    'Slowing Bullets': 'ë‘”í™” íƒ„í™˜',
                    'Tesla Bullets': 'í…ŒìŠ¬ë¼ íƒ„í™˜',
                    'Hollow Point Ward': 'ì¤‘ê³µíƒ„ ë°©ì–´',
                    'Burst Fire': 'ì ì‚¬',
                    'Close Quarters': 'ê·¼ì ‘ ì „íˆ¬',
                    'Long Range': 'ì¥ê±°ë¦¬',
                    'Pristine Emblem': 'ì™„ë²½í•œ ì— ë¸”ëŸ¼',
                    'Vitality Booster': 'ìƒëª…ë ¥ ë¶€ìŠ¤í„°',
                    'Spirit Power': 'ì •ì‹ ë ¥',
                    'Weapon Damage': 'ë¬´ê¸° ë°ë¯¸ì§€',
                    'Ammo Scavenger': 'íƒ„ì•½ ìˆ˜ì§‘ê°€',
                    'Bullet Lifesteal': 'ì´ì•Œ ìƒëª…ë ¥ í¡ìˆ˜',
                    'Spirit Lifesteal': 'ì •ì‹  ìƒëª…ë ¥ í¡ìˆ˜',
                    'Melee Lifesteal': 'ê·¼ì ‘ ìƒëª…ë ¥ í¡ìˆ˜'
                };
                
                // ëª¨ë“  ì•„ì´í…œì— ëŒ€í•´ ë§¤í•‘ ìƒì„±
                items.forEach(item => {
                    if (item.name && koreanNames[item.name]) {
                        itemNames[item.id] = koreanNames[item.name];
                    } else if (item.name) {
                        itemNames[item.id] = item.name;
                    } else {
                        itemNames[item.id] = item.class_name || `ì•„ì´í…œ ${item.id}`;
                    }
                    
                    // ì•„ì´í…œ ì´ë¯¸ì§€ ì €ì¥ (shop_image ìš°ì„ , ì—†ìœ¼ë©´ image ì‚¬ìš©)
                    if (item.shop_image) {
                        itemImages[item.id] = item.shop_image;
                    } else if (item.image) {
                        itemImages[item.id] = item.image;
                    }
                });
                
                // ìºì‹œì— ì €ì¥
                setCachedData(CACHE_KEYS.ITEM_MAPPINGS, {
                    names: itemNames,
                    images: itemImages
                });
                
                console.log('ì•„ì´í…œ ë§¤í•‘ ì™„ë£Œ:', Object.keys(itemNames).length, 'ê°œ');
                return true;
            } catch (error) {
                console.error('ì•„ì´í…œ ë§¤í•‘ ì‹¤íŒ¨:', error);
                // ìºì‹œì—ì„œ ì´ì „ ë°ì´í„° ì‚¬ìš© ì‹œë„
                const cachedMappings = getCachedData(CACHE_KEYS.ITEM_MAPPINGS);
                if (cachedMappings) {
                    Object.assign(itemNames, cachedMappings.names);
                    Object.assign(itemImages, cachedMappings.images);
                    console.log('ì•„ì´í…œ ë§¤í•‘ ìºì‹œ ì‚¬ìš© (ì´ì „ ë°ì´í„°)');
                    return true;
                }
                return false;
            }
        }
        
        function createHeroRankingHTML(items, valueUnit = '') {
            return items.map((item, index) => `
                <div class="ranking-item">
                    <span class="rank-number">${index + 1}</span>
                    <div class="item-info">
                        <div class="hero-image ${item.image ? '' : 'error'}" ${item.image ? `style="background-image: url('${item.image}'); background-size: cover;"` : ''}>
                            ${item.image ? '' : item.name.charAt(0)}
                        </div>
                        <span class="character-name">${item.name}</span>
                    </div>
                    <span class="stat-value">${item.value}${valueUnit}</span>
                </div>
            `).join('');
        }
        
        function createItemRankingHTML(items, valueUnit = '') {
            return items.map((item, index) => `
                <div class="ranking-item">
                    <span class="rank-number">${index + 1}</span>
                    <div class="item-info">
                        <div class="item-image ${item.image ? '' : 'error'}" ${item.image ? `style="background-image: url('${item.image}'); background-size: cover;"` : ''}>
                            ${item.image ? '' : 'ğŸ’'}
                        </div>
                        <span class="item-name">${item.name}</span>
                    </div>
                    <span class="stat-value">${item.value}${valueUnit}</span>
                </div>
            `).join('');
        }
        
        async function loadAndDisplayData() {
            try {
                console.log('1. ì´ë¯¸ì§€ ë° ë§¤í•‘ ë¡œë“œ ì¤‘...');
                updateLoadingStatus('most-played-section', 'ìºë¦­í„° ì´ë¯¸ì§€ ë¡œë“œ ì¤‘...');
                updateLoadingStatus('win-rate-section', 'ì•„ì´í…œ ë°ì´í„° ë¡œë“œ ì¤‘...');
                updateLoadingStatus('items-section', 'í†µê³„ ë°ì´í„° ì¤€ë¹„ ì¤‘...');
                
                const [mappingSuccess] = await Promise.all([
                    loadItemMappings(),
                    loadHeroImages()
                ]);
                
                console.log('2. API ë°ì´í„° ë¡œë“œ ì¤‘...');
                
                // ìºì‹œëœ ë°ì´í„° í™•ì¸
                const cachedHeroStats = getCachedData(CACHE_KEYS.HERO_STATS);
                const cachedItemStats = getCachedData(CACHE_KEYS.ITEM_STATS);
                
                let heroStats, itemStats;
                
                if (cachedHeroStats && cachedItemStats) {
                    console.log('ìºì‹œëœ í†µê³„ ë°ì´í„° ì‚¬ìš©');
                    heroStats = cachedHeroStats;
                    itemStats = cachedItemStats;
                    
                    updateLoadingStatus('most-played-section', 'ìºì‹œ ë°ì´í„° ë¡œë“œ ì¤‘...');
                    updateLoadingStatus('win-rate-section', 'ìºì‹œ ë°ì´í„° ë¡œë“œ ì¤‘...');
                    updateLoadingStatus('items-section', 'ìºì‹œ ë°ì´í„° ë¡œë“œ ì¤‘...');
                } else {
                    updateLoadingStatus('most-played-section', 'í”Œë ˆì´ í†µê³„ ë¡œë“œ ì¤‘...');
                    updateLoadingStatus('win-rate-section', 'ìŠ¹ë¥  ë°ì´í„° ë¡œë“œ ì¤‘...');
                    updateLoadingStatus('items-section', 'ì•„ì´í…œ í†µê³„ ë¡œë“œ ì¤‘...');
                    
                    // 7ì¼ ì „ íƒ€ì„ìŠ¤íƒ¬í”„ ê³„ì‚°
                    const sevenDaysAgo = Math.floor(Date.now() / 1000) - (7 * 24 * 60 * 60);
                    
                    const [heroResponse, itemResponse] = await Promise.all([
                        fetchWithTimeout(`https://api.deadlock-api.com/v1/analytics/hero-stats?min_unix_timestamp=${sevenDaysAgo}`, 15000),
                        fetchWithTimeout(`https://api.deadlock-api.com/v1/analytics/item-stats?min_unix_timestamp=${sevenDaysAgo}`, 15000)
                    ]);
                    
                    heroStats = await heroResponse.json();
                    itemStats = await itemResponse.json();
                    
                    // ìºì‹œì— ì €ì¥
                    setCachedData(CACHE_KEYS.HERO_STATS, heroStats);
                    setCachedData(CACHE_KEYS.ITEM_STATS, itemStats);
                }
                
                console.log('3. ë°ì´í„° ì²˜ë¦¬ ì¤‘...');
                
                // ìºë¦­í„° ë°ì´í„° ì²˜ë¦¬
                const heroData = heroStats.map(hero => ({
                    id: hero.hero_id,
                    name: heroNames[hero.hero_id] || `ìºë¦­í„° ${hero.hero_id}`,
                    matches: hero.matches || 0,
                    winRate: hero.matches > 0 ? ((hero.wins / hero.matches) * 100).toFixed(1) : '0.0',
                    image: heroImages[hero.hero_id] || ''
                }));
                
                // ìµœê³  í”Œë ˆì´ ìºë¦­í„°
                const mostPlayed = heroData
                    .sort((a, b) => b.matches - a.matches)
                    .slice(0, 8)
                    .map(hero => ({ 
                        name: hero.name, 
                        value: hero.matches.toLocaleString(),
                        image: hero.image
                    }));
                
                // ìµœê³  ìŠ¹ë¥  ìºë¦­í„°
                const bestWinRate = heroData
                    .sort((a, b) => parseFloat(b.winRate) - parseFloat(a.winRate))
                    .slice(0, 8)
                    .map(hero => ({ 
                        name: hero.name, 
                        value: hero.winRate,
                        image: hero.image
                    }));
                
                // ì•„ì´í…œ ë°ì´í„° ì²˜ë¦¬
                const maxMatches = Math.max(...itemStats.map(item => item.matches || 0));
                const topItems = itemStats
                    .sort((a, b) => (b.matches || 0) - (a.matches || 0))
                    .slice(0, 8)
                    .map(item => ({
                        name: itemNames[item.item_id] || `ì•„ì´í…œ ${item.item_id}`,
                        value: maxMatches > 0 ? ((item.matches / maxMatches) * 100).toFixed(1) : '0.0',
                        image: itemImages[item.item_id] || ''
                    }));
                
                console.log('4. UI ì—…ë°ì´íŠ¸ ì¤‘...');
                
                // UI ì—…ë°ì´íŠ¸
                document.getElementById('most-played-section').innerHTML = 
                    '<ul class="ranking-list">' + createHeroRankingHTML(mostPlayed) + '</ul>';
                    
                document.getElementById('win-rate-section').innerHTML = 
                    '<ul class="ranking-list">' + createHeroRankingHTML(bestWinRate, '%') + '</ul>';
                    
                document.getElementById('items-section').innerHTML = 
                    '<ul class="ranking-list">' + createItemRankingHTML(topItems, '%') + '</ul>';
                
                // ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
                const now = new Date();
                const updateTime = now.toLocaleString('ko-KR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    timeZone: 'Asia/Seoul'
                });
                
                document.getElementById('last-update').innerHTML = 
                    `<span>ğŸ“… ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${updateTime} (KST)</span>`;
                
                console.log('âœ… ëª¨ë“  ë°ì´í„° ë¡œë”© ì™„ë£Œ!');
                
            } catch (error) {
                console.error('âŒ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
                
                // ìºì‹œëœ ë°ì´í„°ë¡œ í´ë°± ì‹œë„
                const cachedHeroStats = getCachedData(CACHE_KEYS.HERO_STATS);
                const cachedItemStats = getCachedData(CACHE_KEYS.ITEM_STATS);
                
                if (cachedHeroStats && cachedItemStats) {
                    console.log('ğŸ”„ ìºì‹œëœ ë°ì´í„°ë¡œ í´ë°±');
                    
                    try {
                        // ìºì‹œëœ ë°ì´í„°ë¡œ UI ì—…ë°ì´íŠ¸ ì‹œë„
                        const heroData = cachedHeroStats.map(hero => ({
                            id: hero.hero_id,
                            name: heroNames[hero.hero_id] || `ìºë¦­í„° ${hero.hero_id}`,
                            matches: hero.matches || 0,
                            winRate: hero.matches > 0 ? ((hero.wins / hero.matches) * 100).toFixed(1) : '0.0',
                            image: heroImages[hero.hero_id] || ''
                        }));
                        
                        const mostPlayed = heroData
                            .sort((a, b) => b.matches - a.matches)
                            .slice(0, 8)
                            .map(hero => ({ 
                                name: hero.name, 
                                value: hero.matches.toLocaleString(),
                                image: hero.image
                            }));
                        
                        const bestWinRate = heroData
                            .sort((a, b) => parseFloat(b.winRate) - parseFloat(a.winRate))
                            .slice(0, 8)
                            .map(hero => ({ 
                                name: hero.name, 
                                value: hero.winRate,
                                image: hero.image
                            }));
                        
                        const maxMatches = Math.max(...cachedItemStats.map(item => item.matches || 0));
                        const topItems = cachedItemStats
                            .sort((a, b) => (b.matches || 0) - (a.matches || 0))
                            .slice(0, 8)
                            .map(item => ({
                                name: itemNames[item.item_id] || `ì•„ì´í…œ ${item.item_id}`,
                                value: maxMatches > 0 ? ((item.matches / maxMatches) * 100).toFixed(1) : '0.0',
                                image: itemImages[item.item_id] || ''
                            }));
                        
                        document.getElementById('most-played-section').innerHTML = 
                            '<ul class="ranking-list">' + createHeroRankingHTML(mostPlayed) + '</ul>';
                            
                        document.getElementById('win-rate-section').innerHTML = 
                            '<ul class="ranking-list">' + createHeroRankingHTML(bestWinRate, '%') + '</ul>';
                            
                        document.getElementById('items-section').innerHTML = 
                            '<ul class="ranking-list">' + createItemRankingHTML(topItems, '%') + '</ul>';
                        
                        document.getElementById('last-update').innerHTML = 
                            `<span>âš ï¸ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ - ìºì‹œëœ ë°ì´í„° í‘œì‹œ ì¤‘</span>`;
                        
                        return; // ìºì‹œ ë°ì´í„°ë¡œ ì„±ê³µì ìœ¼ë¡œ í‘œì‹œí–ˆìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œ ì¢…ë£Œ
                    } catch (cacheError) {
                        console.error('ìºì‹œ ë°ì´í„° ì²˜ë¦¬ ì‹¤íŒ¨:', cacheError);
                    }
                }
                
                // ìºì‹œë„ ì‹¤íŒ¨í•œ ê²½ìš° ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
                showError('most-played-section', `ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
                showError('win-rate-section', `ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
                showError('items-section', `ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
                
                document.getElementById('last-update').innerHTML = 
                    `<span>âŒ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${error.message}</span>`;
                
                // ì¬ì‹œë„ ë²„íŠ¼ ì¶”ê°€
                setTimeout(() => {
                    document.getElementById('last-update').innerHTML += 
                        '<br><button onclick="loadAndDisplayData()" class="retry-button">ğŸ”„ ë‹¤ì‹œ ì‹œë„</button>';
                }, 1000);
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.addEventListener('load', loadAndDisplayData);
    </script>
</body>
</html>